<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Header Principal Amélioré -->
    <div class="mb-8 relative overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-r from-blue-600/5 to-purple-600/5 rounded-3xl"></div>
      <div class="relative bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-8">
        <!-- Pattern décoratif -->
        <div class="absolute top-0 right-0 w-64 h-64 opacity-5">
          <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <path fill="#3B82F6" d="M60.7,-76.3C75.1,-67.7,82.7,-45.5,86.8,-24.8C90.9,-4.1,91.5,15.1,84.6,30.7C77.7,46.3,63.3,58.3,47.1,66.8C30.9,75.3,12.9,80.3,-6.1,88.7C-25.1,97.1,-45.2,108.9,-59.8,103.1C-74.4,97.3,-83.5,73.9,-86.9,51.3C-90.3,28.7,-88,6.9,-81.8,-11.5C-75.6,-29.9,-65.5,-44.9,-51.8,-53.8C-38.1,-62.7,-20.7,-65.5,0.4,-66.1C21.5,-66.7,46.3,-84.9,60.7,-76.3Z"/>
          </svg>
        </div>
        
        <div class="flex items-center justify-between relative z-10">
          <div class="flex items-center gap-6">
            <!-- Icône principale avec animation -->
            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg transform hover:scale-110 transition-all duration-300">
              <mat-icon class="text-white text-3xl">fact_check</mat-icon>
            </div>
            
            <div>
              <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-2">
                Gestion des Absences
              </h1>
              <p class="text-lg text-gray-600 max-w-md">
                Tableau de bord moderne pour consulter et gérer toutes les absences des étudiants
              </p>
              
              <!-- Badges d'info -->
              <div class="flex gap-3 mt-3">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  <mat-icon class="w-3 h-3 mr-1 text-xs">schedule</mat-icon>
                  Temps réel
                </span>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <mat-icon class="w-3 h-3 mr-1 text-xs">verified</mat-icon>
                  Données vérifiées
                </span>
              </div>
            </div>
          </div>
          
          <!-- Actions avec design amélioré -->
          <div class="flex gap-3">
            <button 
              mat-stroked-button
              class="flex items-center gap-2 px-4 py-2 rounded-xl border-2 border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all duration-300 text-gray-700 hover:text-blue-700"
            >
              <mat-icon class="text-lg">refresh</mat-icon>
              <span class="font-medium">Actualiser</span>
            </button>
            
            <button 
              mat-raised-button
              color="primary"
              class="flex items-center gap-3 px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 bg-gradient-to-r from-blue-600 to-indigo-600 text-white"
            >
              <mat-icon class="text-xl">add_circle</mat-icon>
              <span class="font-semibold">Nouvelle absence</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistiques rapides améliorées -->
    <div *ngIf="!loading && !error && absences.length > 0" class="mb-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Carte Total Absences -->
        <div class="group relative overflow-hidden bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border border-blue-100 hover:border-blue-200 transition-all duration-300 hover:shadow-xl">
          <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-indigo-500/5"></div>
          <div class="relative p-6">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                  <mat-icon class="text-white text-2xl">assessment</mat-icon>
                </div>
                <div>
                  <p class="text-sm font-medium text-blue-700 mb-1">Total Absences</p>
                  <p class="text-3xl font-bold text-blue-900 count-animation">{{ totalItems }}</p>
                  <p class="text-xs text-blue-600 mt-1">Toutes périodes</p>
                </div>
              </div>
              <div class="text-blue-400 opacity-20 group-hover:opacity-40 transition-opacity duration-300">
                <mat-icon class="text-4xl">trending_up</mat-icon>
              </div>
            </div>
          </div>
        </div>

        <!-- Carte Absences Justifiées -->
        <div class="group relative overflow-hidden bg-gradient-to-br from-emerald-50 to-green-50 rounded-2xl border border-emerald-100 hover:border-emerald-200 transition-all duration-300 hover:shadow-xl">
          <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-green-500/5"></div>
          <div class="relative p-6">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                  <mat-icon class="text-white text-2xl">verified</mat-icon>
                </div>
                <div>
                  <p class="text-sm font-medium text-emerald-700 mb-1">Justifiées</p>
                  <p class="text-3xl font-bold text-emerald-900 count-animation">{{ getJustifiedCount() }}</p>
                  <p class="text-xs text-emerald-600 mt-1">{{ getJustificationPercentage() }}% du total</p>
                </div>
              </div>
              <div class="text-emerald-400 opacity-20 group-hover:opacity-40 transition-opacity duration-300">
                <mat-icon class="text-4xl">check_circle_outline</mat-icon>
              </div>
            </div>
          </div>
        </div>

        <!-- Carte Absences Non Justifiées -->
        <div class="group relative overflow-hidden bg-gradient-to-br from-red-50 to-rose-50 rounded-2xl border border-red-100 hover:border-red-200 transition-all duration-300 hover:shadow-xl">
          <div class="absolute inset-0 bg-gradient-to-br from-red-500/5 to-rose-500/5"></div>
          <div class="relative p-6">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                  <mat-icon class="text-white text-2xl">error_outline</mat-icon>
                </div>
                <div>
                  <p class="text-sm font-medium text-red-700 mb-1">Non Justifiées</p>
                  <p class="text-3xl font-bold text-red-900 count-animation">{{ getUnjustifiedCount() }}</p>
                  <p class="text-xs text-red-600 mt-1">Nécessitent attention</p>
                </div>
              </div>
              <div class="text-red-400 opacity-20 group-hover:opacity-40 transition-opacity duration-300">
                <mat-icon class="text-4xl">priority_high</mat-icon>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filtres et Recherche Révolutionnés -->
    <div class="mb-8 relative overflow-hidden">
      <!-- Arrière-plan avec pattern animé -->
      <div class="absolute inset-0 bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/30 rounded-3xl"></div>
      <div class="absolute inset-0 opacity-5 rounded-3xl" style="background-image: radial-gradient(circle at 25% 25%, #3b82f6 2px, transparent 2px), radial-gradient(circle at 75% 75%, #6366f1 2px, transparent 2px); background-size: 50px 50px;"></div>
      
      <!-- Conteneur principal -->
      <div class="relative bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-blue-100/50 p-8">
        <form [formGroup]="filtersForm" class="space-y-8">
          
          <!-- En-tête redesigné -->
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <!-- Icône principale avec animation -->
              <div class="relative">
                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-xl">
                  <mat-icon class="text-white text-2xl spin-slow">tune</mat-icon>
                </div>
                <div class="absolute -inset-1 bg-gradient-to-br from-blue-400 to-purple-600 rounded-2xl opacity-20 animate-pulse"></div>
              </div>
              
              <div>
                <h3 class="text-2xl font-bold bg-gradient-to-r from-gray-900 via-blue-800 to-indigo-900 bg-clip-text text-transparent">
                  Filtres & Recherche Avancée
                </h3>
                <p class="text-sm text-gray-600 mt-1">Trouvez facilement les absences recherchées</p>
              </div>
            </div>
            
            <!-- Indicateur de performance -->
            <div class="flex items-center gap-3">
              <div class="hidden lg:flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-xs font-medium text-green-700">Recherche instantanée</span>
              </div>
              
              <div class="flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                <mat-icon class="text-blue-600 text-sm">flash_on</mat-icon>
                <span class="text-xs font-medium text-blue-700">IA intégrée</span>
              </div>
            </div>
          </div>

          <!-- Section des inputs modernisée -->
          <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
            <!-- Input de recherche révolutionné -->
            <div class="lg:col-span-3 relative group">
              <div class="relative">
                <!-- Label flottant personnalisé -->
                <label class="absolute -top-2 left-4 bg-white px-2 text-xs font-semibold text-gray-600 z-10 transition-all duration-200 group-focus-within:text-blue-600">
                  🔍 Recherche intelligente
                </label>
                
                <!-- Container de l'input avec effets -->
                <div class="relative overflow-hidden rounded-2xl border-2 border-gray-200 bg-white shadow-lg transition-all duration-300 group-focus-within:border-blue-400 group-focus-within:shadow-xl group-hover:border-gray-300">
                  <!-- Effet de brillance -->
                  <div class="absolute inset-0 bg-gradient-to-r from-transparent via-blue-50/20 to-transparent opacity-0 group-focus-within:opacity-100 transition-opacity duration-500"></div>
                  
                  <!-- Input principal -->
                  <div class="relative flex items-center">
                    <div class="absolute left-4 z-10">
                      <mat-icon class="text-gray-400 group-focus-within:text-blue-500 transition-colors duration-200">search</mat-icon>
                    </div>
                    
                    <input 
                      [value]="searchValue"
                      (input)="onSearchChange($event)"
                      (focus)="onSearchFocus()"
                      (blur)="onSearchBlur()"
                      placeholder="Nom, matricule, motif, cours..."
                      class="w-full pl-12 pr-12 py-4 text-base font-medium bg-transparent border-0 outline-0 placeholder-gray-400 text-gray-900 z-10"
                      type="text"
                    >
                    
                    <!-- Bouton de nettoyage -->
                    <div class="absolute right-4 z-10">
                      <button 
                        *ngIf="searchValue" 
                        type="button"
                        (click)="clearSearch()"
                        class="w-6 h-6 bg-gray-100 hover:bg-red-100 rounded-full flex items-center justify-center transition-all duration-200 group"
                      >
                        <mat-icon class="text-gray-400 group-hover:text-red-500 text-sm">close</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
                
                <!-- Indicateur de longueur avec animation -->
                <div *ngIf="searchValue" class="absolute -top-2 right-4">
                  <div class="flex items-center justify-center w-8 h-6 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xs font-bold rounded-full shadow-lg animate-bounce">
                    {{ searchValue.length }}
                  </div>
                </div>
                
                <!-- Suggestions rapides -->
                <div *ngIf="showSearchSuggestions && searchSuggestions.length > 0" 
                     class="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 max-h-60 overflow-y-auto">
                  <div class="p-2">
                    <div class="text-xs font-semibold text-gray-500 mb-2 px-3">Suggestions rapides</div>
                    <div *ngFor="let suggestion of searchSuggestions" 
                         (click)="selectSearchSuggestion(suggestion)"
                         class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-50 cursor-pointer transition-colors duration-150">
                      <mat-icon class="text-blue-500 text-sm">{{ suggestion.icon }}</mat-icon>
                      <span class="text-sm font-medium">{{ suggestion.text }}</span>
                      <span class="text-xs text-gray-500 ml-auto">{{ suggestion.count }} résultats</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Select de statut modernisé -->
            <div class="lg:col-span-2 relative group">
              <div class="relative">
                <!-- Label flottant personnalisé -->
                <label class="absolute -top-2 left-4 bg-white px-2 text-xs font-semibold text-gray-600 z-10 transition-all duration-200 group-focus-within:text-indigo-600">
                  📊 Statut de justification
                </label>
                
                <!-- Container du select -->
                <div class="relative overflow-hidden rounded-2xl border-2 border-gray-200 bg-white shadow-lg transition-all duration-300 group-focus-within:border-indigo-400 group-focus-within:shadow-xl group-hover:border-gray-300">
                  <!-- Effet de brillance -->
                  <div class="absolute inset-0 bg-gradient-to-r from-transparent via-indigo-50/20 to-transparent opacity-0 group-focus-within:opacity-100 transition-opacity duration-500"></div>
                  
                  <!-- Select avec style personnalisé -->
                  <div class="relative flex items-center">
                    <div class="absolute left-4 z-10">
                      <mat-icon class="text-gray-400 group-focus-within:text-indigo-500 transition-colors duration-200">filter_alt</mat-icon>
                    </div>
                    
                    <select 
                      [value]="filtersForm.get('justifiee')?.value || ''"
                      (change)="onJustificationChange($event)"
                      class="w-full pl-12 pr-12 py-4 text-base font-medium bg-transparent border-0 outline-0 text-gray-900 cursor-pointer appearance-none z-10"
                    >
                      <option value="">Tous les statuts</option>
                      <option value="true">✅ Justifiées uniquement</option>
                      <option value="false">❌ Non justifiées uniquement</option>
                    </select>
                    
                    <!-- Icône de dropdown -->
                    <div class="absolute right-4 z-10 pointer-events-none">
                      <mat-icon class="text-gray-400 group-focus-within:text-indigo-500 transition-colors duration-200">expand_more</mat-icon>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Section des résultats et actions -->
          <div class="flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6 pt-6 border-t border-gray-100">
            <!-- Métriques et filtres actifs -->
            <div class="flex flex-wrap items-center gap-4">
              <!-- Compteur de résultats modernisé -->
              <div class="flex items-center gap-3 px-4 py-2 bg-gradient-to-r from-gray-50 to-slate-50 rounded-xl border border-gray-200 shadow-sm">
                <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                  <mat-icon class="text-white text-sm">analytics</mat-icon>
                </div>
                <div class="text-sm">
                  <div class="font-bold text-gray-900" *ngIf="totalItems > 0">
                    {{ (currentPage - 1) * pageSize + 1 }}-{{ Math.min(currentPage * pageSize, totalItems) }}
                    <span class="text-gray-500 font-normal">sur</span> {{ totalItems }}
                  </div>
                  <div class="font-bold text-gray-900" *ngIf="totalItems === 0">Aucun résultat</div>
                  <div class="text-xs text-gray-500">{{ totalItems === 1 ? 'absence trouvée' : 'absences trouvées' }}</div>
                </div>
              </div>
              
              <!-- Pills de filtres actifs -->
              <div class="flex flex-wrap gap-2">
                <!-- Filtre de justification actif -->
                <div *ngIf="filtersForm.get('justifiee')?.value !== ''" 
                     class="group flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-100 to-blue-50 text-blue-800 rounded-xl border border-blue-200 shadow-sm">
                  <mat-icon class="text-blue-600 text-sm">filter_list</mat-icon>
                  <span class="font-medium text-sm">{{ getActiveFilterLabel() }}</span>
                  <button 
                    type="button" 
                    (click)="filtersForm.patchValue({justifiee: ''})"
                    class="w-5 h-5 bg-blue-200 hover:bg-red-200 rounded-full flex items-center justify-center transition-all duration-200 group"
                  >
                    <mat-icon class="text-blue-700 group-hover:text-red-700 text-xs">close</mat-icon>
                  </button>
                </div>
                
                <!-- Recherche active -->
                <div *ngIf="searchValue" 
                     class="group flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-100 to-purple-50 text-purple-800 rounded-xl border border-purple-200 shadow-sm">
                  <mat-icon class="text-purple-600 text-sm">search</mat-icon>
                  <span class="font-medium text-sm max-w-32 truncate">{{ searchValue }}</span>
                  <button 
                    type="button" 
                    (click)="clearSearch()"
                    class="w-5 h-5 bg-purple-200 hover:bg-red-200 rounded-full flex items-center justify-center transition-all duration-200 group"
                  >
                    <mat-icon class="text-purple-700 group-hover:text-red-700 text-xs">close</mat-icon>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Boutons d'actions modernisés -->
            <div class="flex gap-3">
              <button 
                type="button"
                (click)="resetFilters()"
                class="group flex items-center gap-3 px-6 py-3 bg-white border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 font-medium text-gray-700"
              >
                <mat-icon class="text-gray-500 group-hover:text-gray-700 transition-colors duration-200">refresh</mat-icon>
                <span>Réinitialiser</span>
              </button>
              
              <button 
                type="button"
                (click)="loadAbsences()"
                [class]="loading ? 'opacity-75 cursor-not-allowed' : 'hover:shadow-2xl transform hover:scale-105'"
                class="flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white rounded-xl shadow-xl transition-all duration-200 font-semibold"
              >
                <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
                <mat-icon *ngIf="!loading" class="text-white">search</mat-icon>
                <span>{{ loading ? 'Recherche...' : 'Rechercher' }}</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Statut de connexion -->
    <div *ngIf="error" class="mb-6 bg-red-50 border border-red-200 rounded-xl p-6">
      <div class="flex items-center">
        <mat-icon class="text-red-500 mr-3">error</mat-icon>
        <div>
          <h3 class="text-lg font-semibold text-red-800">Erreur de connexion</h3>
          <p class="text-red-600 mt-1">{{ error }}</p>
          <button 
            mat-raised-button 
            color="primary" 
            (click)="loadAbsences()" 
            class="mt-3"
            [disabled]="loading"
          >
            <mat-spinner *ngIf="loading" diameter="20" class="mr-2"></mat-spinner>
            Réessayer
          </button>
        </div>
      </div>
    </div>

    <!-- Loading spinner -->
    <div *ngIf="loading && !error" class="mb-6 bg-blue-50 border border-blue-200 rounded-xl p-6">
      <div class="flex items-center justify-center">
        <mat-spinner diameter="40" class="mr-4"></mat-spinner>
        <div>
          <h3 class="text-lg font-semibold text-blue-800">Chargement en cours...</h3>
          <p class="text-blue-600 mt-1">Récupération des données depuis l'API Laravel</p>
        </div>
      </div>
    </div>

    <!-- Contenu principal -->
    <div class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
      <div class="text-center py-12" *ngIf="!loading && !error && absences.length === 0">
        <mat-icon class="text-blue-500 text-6xl mb-4">assignment</mat-icon>
        <h3 class="text-xl font-medium text-gray-900 mb-2">Aucune absence trouvée</h3>
        <p class="text-gray-500">Aucune donnée d'absence n'est disponible pour le moment.</p>
        <div class="mt-4 text-sm text-gray-400">
          <p>🔗 URL de l'API : <code class="bg-gray-100 px-2 py-1 rounded">http://127.0.0.1:8000/api/absences</code></p>
        </div>
      </div>

      <!-- Liste des absences -->
      <div *ngIf="!loading && !error && absences.length > 0">
        <div class="space-y-6">
          <div *ngFor="let absence of absences; trackBy: trackByAbsenceId; let i = index" 
               class="group relative overflow-hidden bg-white/80 backdrop-blur-sm border border-gray-100 rounded-2xl p-6 hover:shadow-2xl hover:border-blue-200 transition-all duration-300 transform hover:-translate-y-1 fade-in-up card-shine"
               [style.animation-delay]="(i * 100) + 'ms'">
            
            <!-- Gradient de fond subtil -->
            <div class="absolute inset-0 bg-gradient-to-br from-white to-gray-50/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            
            <div class="relative flex items-start space-x-6">
              <!-- Avatar de l'étudiant amélioré -->
              <div class="flex-shrink-0 relative">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg shadow-lg group-hover:shadow-xl group-hover:scale-110 transition-all duration-300">
                  {{ getStudentInitials(absence) }}
                </div>
                <!-- Indicateur de statut -->
                <div class="absolute -bottom-1 -right-1 w-6 h-6 rounded-full border-2 border-white shadow-lg flex items-center justify-center" 
                     [class]="absence.justifiee ? 'bg-green-500' : 'bg-red-500'">
                  <mat-icon class="text-white text-xs">{{ getJustificationIcon(absence.justifiee) }}</mat-icon>
                </div>
              </div>

              <!-- Informations principales -->
              <div class="flex-1 min-w-0">
                <!-- En-tête avec nom et actions -->
                <div class="flex items-start justify-between mb-4">
                  <!-- Informations étudiant -->
                  <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                      <h3 class="text-xl font-bold text-gray-900 group-hover:text-blue-700 transition-colors duration-300">
                        {{ getStudentFullName(absence) }}
                      </h3>
                      <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-mono font-bold bg-blue-100 text-blue-800">
                        {{ getStudentMatricule(absence) }}
                      </span>
                    </div>
                    
                    <!-- Date et type d'absence -->
                    <div class="flex items-center gap-4 mb-3">
                      <div class="flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-1 rounded-lg">
                        <mat-icon class="text-xs text-gray-400">event</mat-icon>
                        <span class="font-medium">{{ formatDate(absence.date_absence) }}</span>
                      </div>
                      <div *ngIf="absence.type_absence" class="flex items-center gap-2 text-sm text-gray-600 bg-purple-50 px-3 py-1 rounded-lg">
                        <mat-icon class="text-xs text-purple-400">category</mat-icon>
                        <span>{{ absence.type_absence }}</span>
                      </div>
                    </div>

                    <!-- Debug info condensée -->
                    <div class="text-xs text-gray-400" *ngIf="!absence.etudiant">
                      <span class="inline-flex items-center gap-1 px-2 py-1 bg-red-50 text-red-600 rounded">
                        <mat-icon class="text-xs">warning</mat-icon>
                        Données manquantes (ID: {{ absence.etudiant_id }})
                      </span>
                    </div>
                  </div>

                  <!-- Actions et statut -->
                  <div class="flex items-center gap-3 ml-4">
                    <!-- Badge de statut amélioré -->
                    <div class="relative">
                      <span [class]="'inline-flex items-center px-4 py-2 rounded-xl text-sm font-semibold shadow-sm status-badge ' + getJustificationBadgeClass(absence.justifiee)">
                        <mat-icon class="w-4 h-4 mr-2">{{ getJustificationIcon(absence.justifiee) }}</mat-icon>
                        {{ absence.justifiee ? 'Justifiée' : 'Non justifiée' }}
                      </span>
                    </div>
                    
                    <!-- Menu d'actions -->
                    <div class="flex gap-2">
                      <button 
                        mat-icon-button
                        class="text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-all duration-200 rounded-xl"
                        matTooltip="Modifier cette absence"
                        [disabled]="loading"
                      >
                        <mat-icon class="text-lg">edit</mat-icon>
                      </button>
                      
                      <button 
                        mat-icon-button
                        (click)="confirmDelete(absence)"
                        class="text-gray-400 hover:text-red-600 hover:bg-red-50 transition-all duration-200 rounded-xl"
                        matTooltip="Supprimer cette absence"
                        [disabled]="loading"
                      >
                        <mat-icon class="text-lg">delete_outline</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Détails de l'absence -->
                <div class="mt-4 space-y-3">
                  <!-- Date d'absence -->
                  <div class="flex items-center gap-2 text-sm">
                    <mat-icon class="text-gray-400 text-sm">event</mat-icon>
                    <span class="text-gray-600">Date d'absence:</span>
                    <span class="font-medium">{{ formatDate(absence.date_absence) }}</span>
                  </div>

                  <!-- Informations du cours (si disponible) -->
                  <div *ngIf="absence.cours" class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="flex items-center gap-2 mb-2">
                      <mat-icon class="text-blue-600 text-sm">school</mat-icon>
                      <span class="font-semibold text-blue-800">Cours: {{ absence.cours?.name }}</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-700">
                      <div>📅 Date du cours: {{ formatDate(absence.cours?.date || '') }}</div>
                      <div>🕐 Horaires: {{ formatTime(absence.cours?.heure_debut || '') }} - {{ formatTime(absence.cours?.heure_fin || '') }}</div>
                      <div *ngIf="absence.cours?.etablissement?.name">🏫 Établissement: {{ absence.cours.etablissement?.name }}</div>
                      <div *ngIf="absence.cours?.promotion?.name">🎓 Promotion: {{ absence.cours.promotion?.name }}</div>
                      <div *ngIf="absence.cours?.salle_id">🚪 Salle ID: {{ absence.cours?.salle_id }}</div>
                      <div>📚 Année: {{ absence.cours?.annee_universitaire }}</div>
                    </div>
                  </div>

                  <!-- Informations de l'examen (si disponible) -->
                  <div *ngIf="absence.examen" class="p-3 bg-purple-50 rounded-lg border border-purple-200">
                    <div class="flex items-center gap-2 mb-2">
                      <mat-icon class="text-purple-600 text-sm">quiz</mat-icon>
                      <span class="font-semibold text-purple-800">Examen: {{ absence.examen?.title }}</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-700">
                      <div>📅 Date: {{ formatDate(absence.examen?.date || '') }}</div>
                      <div>🕐 Horaires: {{ formatTime(absence.examen?.heure_debut || '') }} - {{ formatTime(absence.examen?.heure_fin || '') }}</div>
                      <div *ngIf="absence.examen?.etablissement?.name">🏫 Établissement: {{ absence.examen.etablissement?.name }}</div>
                      <div *ngIf="absence.examen?.promotion?.name">🎓 Promotion: {{ absence.examen.promotion?.name }}</div>
                      <div *ngIf="absence.examen?.salle?.name">🚪 Salle: {{ absence.examen.salle?.name }}</div>
                      <div>📚 Année: {{ absence.examen?.annee_universitaire }}</div>
                    </div>
                  </div>

                  <!-- Informations de l'étudiant détaillées -->
                  <div *ngIf="absence.etudiant" class="p-3 bg-green-50 rounded-lg border border-green-200">
                    <div class="flex items-center gap-2 mb-2">
                      <mat-icon class="text-green-600 text-sm">person</mat-icon>
                      <span class="font-semibold text-green-800">Détails étudiant</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-700">
                      <div>📧 Email: {{ absence.etudiant?.email }}</div>
                      <div *ngIf="absence.etudiant?.promotion?.name">🎓 Promotion: {{ absence.etudiant.promotion?.name }}</div>
                      <div *ngIf="absence.etudiant?.etablissement?.name">🏫 Établissement: {{ absence.etudiant.etablissement?.name }}</div>
                      <div *ngIf="absence.etudiant?.ville?.name">🏙️ Ville: {{ absence.etudiant.ville?.name }}</div>
                      <div *ngIf="absence.etudiant?.group?.title">👥 Groupe: {{ absence.etudiant.group?.title }}</div>
                      <div *ngIf="absence.etudiant?.option?.name">📖 Option: {{ absence.etudiant.option?.name }}</div>
                    </div>
                  </div>

                  <!-- Métadonnées de l'absence -->
                  <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="flex items-center gap-2 mb-2">
                      <mat-icon class="text-gray-600 text-sm">info</mat-icon>
                      <span class="font-semibold text-gray-800">Informations système</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-600">
                      <div>🆔 ID Absence: {{ absence.id }}</div>
                      <div>📅 Créé le: {{ formatDateTime(absence.created_at) }}</div>
                      <div>✏️ Modifié le: {{ formatDateTime(absence.updated_at) }}</div>
                      <div *ngIf="absence.cours_id">🔗 Cours ID: {{ absence.cours_id }}</div>
                      <div *ngIf="absence.examen_id">🔗 Examen ID: {{ absence.examen_id }}</div>
                    </div>
                  </div>


                </div>

                <!-- Motif et justificatif -->
                <div *ngIf="absence.motif || absence.justificatif" class="mt-4 p-3 bg-gray-50 rounded-lg">
                  <div *ngIf="absence.motif" class="mb-2">
                    <span class="text-sm font-medium text-gray-700">Motif:</span>
                    <p class="text-sm text-gray-600 mt-1">{{ absence.motif }}</p>
                  </div>
                  <div *ngIf="absence.justificatif">
                    <span class="text-sm font-medium text-gray-700">Justificatif:</span>
                    <p class="text-sm text-gray-600 mt-1">{{ absence.justificatif }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div *ngIf="totalPages > 1" class="mt-8 bg-white rounded-xl p-4 border border-gray-200">
          <div class="flex items-center justify-between">
            <!-- Sélecteur de taille de page -->
            <div class="flex items-center gap-2">
              <span class="text-sm text-gray-600">Afficher:</span>
              <mat-form-field appearance="outline" class="w-20">
                <mat-select [value]="pageSize" (selectionChange)="onPageSizeChange($event.value)">
                  <mat-option *ngFor="let size of pageSizeOptions" [value]="size">
                    {{ size }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <span class="text-sm text-gray-600">par page</span>
            </div>

            <!-- Navigation pagination -->
            <div class="flex items-center gap-2">
              <button 
                mat-icon-button
                [disabled]="currentPage <= 1"
                (click)="onPageChange(currentPage - 1)"
                class="disabled:opacity-50"
              >
                <mat-icon>chevron_left</mat-icon>
              </button>

              <span class="text-sm text-gray-600 px-4">
                Page {{ currentPage }} sur {{ totalPages }}
              </span>

              <button 
                mat-icon-button
                [disabled]="currentPage >= totalPages"
                (click)="onPageChange(currentPage + 1)"
                class="disabled:opacity-50"
              >
                <mat-icon>chevron_right</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Debug info -->
      <div class="mt-8 pt-6 border-t border-gray-200" *ngIf="!loading">
        <details class="text-sm text-gray-500">
          <summary class="cursor-pointer font-medium">🐛 Informations de debug</summary>
          <div class="mt-2 bg-gray-50 p-3 rounded">
            <p><strong>URL API:</strong> http://127.0.0.1:8000/api/absences</p>
            <p><strong>Status:</strong> {{ error ? 'Erreur' : 'Connecté' }}</p>
            <p><strong>Nombre d'absences:</strong> {{ absences.length }}</p>
            <p><strong>Dernière mise à jour:</strong> {{ getCurrentTime() }}</p>
          </div>
        </details>
      </div>
    </div>
  </div>
</div>

