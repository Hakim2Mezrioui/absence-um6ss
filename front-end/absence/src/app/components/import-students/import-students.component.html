<div class="min-h-screen bg-gradient-to-br from-blue-50/30 to-white relative">
  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
    
    <!-- Header Ultra-Professionnel -->
    <div class="relative">
      <div class="bg-white rounded-2xl border border-blue-200 shadow-lg p-8 lg:p-12">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8">
          <div class="flex items-start gap-6">
            <div class="relative">
              <div class="w-20 h-20 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                <mat-icon class="text-white text-4xl">cloud_upload</mat-icon>
              </div>
              <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-white flex items-center justify-center">
                <mat-icon class="text-white text-sm">add</mat-icon>
              </div>
            </div>
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <h1 class="text-3xl lg:text-4xl font-light text-slate-900 tracking-tight">
                Importation d'Étudiants
              </h1>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200">
                  CSV Import
                </span>
              </div>
              <p class="text-slate-600 text-lg leading-relaxed max-w-2xl">
                Importez et gérez massivement vos étudiants via un fichier CSV sécurisé avec validation automatique
              </p>
              <div class="flex items-center gap-6 text-sm text-slate-500">
                <span class="flex items-center gap-2">
                  <mat-icon class="text-green-500 text-base">verified</mat-icon>
                  Validation automatique
                </span>
                <span class="flex items-center gap-2">
                  <mat-icon class="text-blue-500 text-base">security</mat-icon>
                  Import sécurisé
                </span>
              </div>
            </div>
          </div>
          
          <div class="flex flex-col sm:flex-row gap-4">
            <button 
              (click)="downloadTemplate()"
              [disabled]="loading"
              class="inline-flex items-center justify-center px-8 py-4 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
            >
              <mat-icon class="mr-3 text-xl">download</mat-icon>
              <span>Télécharger le modèle</span>
            </button>
            
            <button 
              (click)="goBack()"
              [disabled]="loading"
              class="inline-flex items-center justify-center px-8 py-4 text-sm font-medium text-slate-700 bg-white border-2 border-slate-200 rounded-xl hover:bg-slate-50 hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-500 disabled:opacity-50"
            >
              <mat-icon class="mr-3 text-xl">arrow_back</mat-icon>
              <span>Retour</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Configuration Professionnelle -->
    <div *ngIf="showConfiguration" class="relative">
      <div class="bg-white/80 backdrop-blur-sm rounded-3xl border border-white/20 shadow-xl shadow-slate-500/5 overflow-hidden">
        <!-- Header Élégant -->
        <div class="relative bg-gradient-to-r from-slate-50 to-blue-50/50 border-b border-slate-200/50 px-8 py-6">
          <div class="flex items-center gap-6">
            <div class="relative">
              <div class="w-14 h-14 bg-gradient-to-br from-slate-600 to-slate-700 rounded-2xl flex items-center justify-center shadow-lg">
                <mat-icon class="text-white text-2xl">tune</mat-icon>
              </div>
              <div class="absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full border-2 border-white"></div>
            </div>
            <div class="space-y-2">
              <h2 class="text-2xl lg:text-3xl font-extralight text-slate-900 tracking-tight">
                Configuration d'Importation
              </h2>
              <p class="text-slate-600 leading-relaxed">
                Définissez les paramètres globaux pour l'importation de vos étudiants
              </p>
            </div>
          </div>
        </div>
        
        <!-- Content Structuré -->
        <div class="p-8 lg:p-12">
        
          <form [formGroup]="configForm" class="space-y-10">
            <!-- Instructions Professionnelles -->
            <div class="relative">
              <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-indigo-500/5 rounded-2xl"></div>
              <div class="relative bg-gradient-to-r from-blue-50/50 to-indigo-50/30 border border-blue-200/50 rounded-2xl p-8">
                <div class="flex items-start gap-6">
                  <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
                      <mat-icon class="text-white text-xl">info</mat-icon>
                    </div>
              </div>
                  <div class="space-y-4">
                    <h4 class="text-xl font-semibold text-slate-900 tracking-tight">
                      Configuration des Relations
                    </h4>
                    <p class="text-slate-600 leading-relaxed text-lg">
                      Définissez les informations institutionnelles qui seront automatiquement assignées à tous les étudiants lors de l'importation. Ces paramètres garantissent la cohérence des données.
                    </p>
                    <div class="flex items-center gap-4 text-sm text-slate-500">
                      <span class="flex items-center gap-2">
                        <mat-icon class="text-emerald-500 text-base">check_circle</mat-icon>
                        Configuration globale
                      </span>
                      <span class="flex items-center gap-2">
                        <mat-icon class="text-blue-500 text-base">link</mat-icon>
                        Relations automatiques
                      </span>
                    </div>
                  </div>
                </div>
            </div>
          </div>

            <!-- Grid de Configuration Ultra-Moderne -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Promotion -->
              <div class="group relative">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-cyan-500/5 rounded-2xl transition-opacity group-hover:opacity-75"></div>
                <div class="relative bg-white/70 backdrop-blur-sm border border-slate-200/50 rounded-2xl p-6 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-blue-500/10">
                  <label class="block space-y-4">
                    <div class="flex items-center gap-4">
                      <div class="w-10 h-10 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-lg">
                        <mat-icon class="text-slate-600 text-lg">school</mat-icon>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2">
                          <span class="text-lg font-semibold text-slate-900">Promotion</span>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">Requis</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-1">Année d'étude des étudiants</p>
                      </div>
                </div>
              <select 
                formControlName="promotion_id" 
                      class="w-full px-4 py-4 text-slate-900 bg-white border-2 border-slate-200 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 hover:border-slate-300 text-base"
              >
                      <option value="" class="text-slate-500">Sélectionnez une promotion</option>
                      <option *ngFor="let promotion of filterOptions.promotions" [value]="promotion.id" class="text-slate-900">
                  {{ promotion.name }}
                </option>
              </select>
                  </label>
                </div>
            </div>

            <!-- Établissement -->
              <div class="group relative">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-blue-500/5 rounded-2xl transition-opacity group-hover:opacity-75"></div>
                <div class="relative bg-white/70 backdrop-blur-sm border border-slate-200/50 rounded-2xl p-6 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-blue-500/10">
                  <label class="block space-y-4">
                    <div class="flex items-center gap-4">
                      <div class="w-10 h-10 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-lg">
                        <mat-icon class="text-slate-600 text-lg">business</mat-icon>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2">
                          <span class="text-lg font-semibold text-slate-900">Établissement</span>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">Requis</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-1">Institution d'enseignement</p>
                      </div>
                </div>
                    <select 
                      formControlName="etablissement_id" 
                      class="w-full px-4 py-4 text-slate-900 bg-white border-2 border-slate-200 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 hover:border-slate-300 text-base"
                    >
                      <option value="" class="text-slate-500">Sélectionnez un établissement</option>
                      <option *ngFor="let etablissement of filterOptions.etablissements" [value]="etablissement.id" class="text-slate-900">
                  {{ etablissement.name }}
                </option>
              </select>
                  </label>
                </div>
            </div>

            <!-- Ville -->
              <div class="group relative">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-blue-500/5 rounded-2xl transition-opacity group-hover:opacity-75"></div>
                <div class="relative bg-white/70 backdrop-blur-sm border border-slate-200/50 rounded-2xl p-6 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-blue-500/10">
                  <label class="block space-y-4">
                    <div class="flex items-center gap-4">
                      <div class="w-10 h-10 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-lg">
                        <mat-icon class="text-slate-600 text-lg">location_city</mat-icon>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2">
                          <span class="text-lg font-semibold text-slate-900">Ville</span>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">Requis</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-1">Localisation géographique</p>
                      </div>
                </div>
                    <select 
                      formControlName="ville_id" 
                      class="w-full px-4 py-4 text-slate-900 bg-white border-2 border-slate-200 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 hover:border-slate-300 text-base"
                    >
                      <option value="" class="text-slate-500">Sélectionnez une ville</option>
                      <option *ngFor="let ville of filterOptions.villes" [value]="ville.id" class="text-slate-900">
                  {{ ville.name }}
                </option>
              </select>
                  </label>
                </div>
            </div>

            <!-- Groupe -->
              <div class="group relative">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-blue-500/5 rounded-2xl transition-opacity group-hover:opacity-75"></div>
                <div class="relative bg-white/70 backdrop-blur-sm border border-slate-200/50 rounded-2xl p-6 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-blue-500/10">
                  <label class="block space-y-4">
                    <div class="flex items-center gap-4">
                      <div class="w-10 h-10 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-lg">
                        <mat-icon class="text-slate-600 text-lg">group</mat-icon>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2">
                          <span class="text-lg font-semibold text-slate-900">Groupe</span>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">Requis</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-1">Groupe de classe des étudiants</p>
                      </div>
                </div>
                    <select 
                      formControlName="group_id" 
                      class="w-full px-4 py-4 text-slate-900 bg-white border-2 border-slate-200 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 hover:border-slate-300 text-base"
                    >
                      <option value="" class="text-slate-500">Sélectionnez un groupe</option>
                      <option *ngFor="let group of filterOptions.groups" [value]="group.id" class="text-slate-900">
                  {{ group.title }}
                </option>
              </select>
                  </label>
                </div>
            </div>

            <!-- Option -->
              <div class="group relative">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-blue-500/5 rounded-2xl transition-opacity group-hover:opacity-75"></div>
                <div class="relative bg-white/70 backdrop-blur-sm border border-slate-200/50 rounded-2xl p-6 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-blue-500/10">
                  <label class="block space-y-4">
                    <div class="flex items-center gap-4">
                      <div class="w-10 h-10 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-lg">
                        <mat-icon class="text-slate-600 text-lg">category</mat-icon>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2">
                          <span class="text-lg font-semibold text-slate-900">Option</span>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">Requis</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-1">Spécialisation ou filière</p>
                      </div>
                </div>
                    <select 
                      formControlName="option_id" 
                      class="w-full px-4 py-4 text-slate-900 bg-white border-2 border-slate-200 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 hover:border-slate-300 text-base"
                    >
                      <option value="" class="text-slate-500">Sélectionnez une option</option>
                      <option *ngFor="let option of filterOptions.options" [value]="option.id" class="text-slate-900">
                  {{ option.name }}
                </option>
              </select>
                  </label>
                </div>
            </div>

            <!-- Mode de traitement des doublons -->
              <div class="lg:col-span-2 group relative">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-blue-500/5 rounded-2xl transition-opacity group-hover:opacity-75"></div>
                <div class="relative bg-white/70 backdrop-blur-sm border border-slate-200/50 rounded-2xl p-6 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-blue-500/10">
                  <label class="block space-y-4">
                    <div class="flex items-center gap-4">
                      <div class="w-10 h-10 bg-white border-2 border-slate-200 rounded-xl flex items-center justify-center shadow-lg">
                        <mat-icon class="text-slate-600 text-lg">tune</mat-icon>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2">
                          <span class="text-lg font-semibold text-slate-900">Gestion des Doublons</span>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">Avancé</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-1">Stratégie en cas d'étudiant existant dans le système</p>
                      </div>
                </div>
                    <select 
                      [(ngModel)]="importOptions.duplicateMode"
                      class="w-full px-4 py-4 text-slate-900 bg-white border-2 border-slate-200 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 hover:border-slate-300 text-base"
                    >
                      <option value="update" class="text-slate-900">🔄 Mettre à jour les informations existantes</option>
                      <option value="skip" class="text-slate-900">⏭️ Ignorer les doublons</option>
                      <option value="error" class="text-slate-900">❌ Signaler comme erreur</option>
              </select>
                  </label>
                </div>
              </div>
            </div>

            <!-- Confirmation Professionnelle -->
            <div class="mt-10 relative">
              <div class="absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-green-500/10 rounded-2xl"></div>
              <div class="relative bg-gradient-to-r from-emerald-50/80 to-green-50/80 border border-emerald-200/50 rounded-2xl p-8">
                <div class="flex items-center gap-6">
                  <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg">
                      <mat-icon class="text-white text-xl">auto_awesome</mat-icon>
                    </div>
                  </div>
                  <div class="flex-1">
                    <h5 class="text-lg font-semibold text-slate-900 mb-2">
                      Configuration Automatique Active
                    </h5>
                    <p class="text-slate-600">
                      Les paramètres définis ci-dessus seront automatiquement appliqués à tous les étudiants importés
                    </p>
                  </div>
                  <div class="flex items-center gap-2 text-sm text-emerald-700">
                    <mat-icon class="text-emerald-500">check_circle</mat-icon>
                    <span class="font-medium">Prêt</span>
            </div>
          </div>
              </div>
            </div>
          </form>
          </div>
      </div>
    </div>


    <!-- Zone d'Upload Ultra-Moderne avec Effets Avancés -->
    <div class="relative group">
      <!-- Animated Background -->
      <div class="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-indigo-50/30 to-purple-50/20 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-1000"></div>
      
      <div class="relative bg-white/90 backdrop-blur-md rounded-3xl border border-white/30 shadow-2xl shadow-blue-500/10 overflow-hidden transform transition-all duration-500 group-hover:scale-[1.01] group-hover:shadow-3xl group-hover:shadow-blue-500/20">
        <!-- Header Élégant -->
        <div class="relative bg-gradient-to-r from-slate-50 to-blue-50/50 border-b border-slate-200/50 px-8 py-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-6">
              <div class="relative">
                <div class="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                  <mat-icon class="text-white text-2xl">cloud_upload</mat-icon>
                </div>
                <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-white flex items-center justify-center">
                  <mat-icon class="text-white text-xs">add</mat-icon>
                </div>
              </div>
              <div class="space-y-2">
                <h2 class="text-2xl lg:text-3xl font-extralight text-slate-900 tracking-tight">
                  Sélection du Fichier
                </h2>
                <div class="flex items-center gap-4 text-sm text-slate-500">
                  <span class="flex items-center gap-2">
                    <mat-icon class="text-blue-500 text-base">description</mat-icon>
                    Format CSV uniquement
                  </span>
                  <span class="flex items-center gap-2">
                    <mat-icon class="text-emerald-500 text-base">verified</mat-icon>
                    Validation automatique
                  </span>
                </div>
              </div>
          </div>
          
            <!-- Indicateur de progression -->
          <div class="text-center" *ngIf="uploadProgress > 0">
              <div class="w-16 h-16 bg-green-500 rounded-xl flex items-center justify-center shadow-lg mx-auto">
                <div class="text-lg font-bold text-white">{{ uploadProgress }}%</div>
              </div>
              <div class="text-sm text-slate-600 font-medium mt-3">
                Traitement en cours
              </div>
          </div>
        </div>
      </div>

      <!-- Contenu principal -->
      <div class="p-6">
        <!-- Messages d'état -->
        <div *ngIf="loading" class="mb-6 flex items-center gap-3 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <mat-spinner diameter="24"></mat-spinner>
          <span class="text-blue-700 font-medium">{{ loadingMessage || 'Traitement en cours...' }}</span>
        </div>

        <div *ngIf="error" class="mb-6 flex items-center gap-3 bg-red-50 border border-red-200 rounded-lg p-4">
          <mat-icon class="text-red-500">error</mat-icon>
          <span class="text-red-700 font-medium">{{ error }}</span>
        </div>

        <div *ngIf="success" class="mb-6 flex items-center gap-3 bg-green-50 border border-green-200 rounded-lg p-4">
          <mat-icon class="text-green-500">check_circle</mat-icon>
          <span class="text-green-700 font-medium">{{ success }}</span>
        </div>

        <!-- Zone de Dépôt -->
        <div class="p-8 lg:p-12">
          <div 
            class="border-2 border-dashed border-slate-200 rounded-2xl p-16 text-center transition-colors duration-200 hover:border-blue-400 hover:bg-blue-50/30"
            [class.border-blue-500]="isDragOver"
            [class.bg-blue-50]="isDragOver"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onFileDropped($event)"
          >
              <div class="space-y-8">
                <!-- Icône centrale -->
              <div class="flex justify-center">
                  <div class="w-24 h-24 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                    <mat-icon class="text-white text-4xl">cloud_upload</mat-icon>
                  </div>
                </div>
                
                <!-- Contenu textuel -->
                <div class="space-y-4">
                  <div class="space-y-2">
                    <h3 class="text-2xl lg:text-3xl font-light text-slate-900">
                      Déposez votre fichier CSV
                    </h3>
                    <p class="text-slate-500 text-lg">
                      ou cliquez pour parcourir vos fichiers
                    </p>
              </div>
              
                  <!-- Spécifications techniques -->
                  <div class="inline-flex items-center gap-8 text-sm text-slate-400">
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                      <span>CSV seulement</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-emerald-400 rounded-full"></div>
                      <span>Max 10 MB</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                      <span>Validation auto</span>
                    </div>
                  </div>
              </div>
              
                <!-- Bouton -->
              <div>
                <input 
                  type="file" 
                  #fileInput 
                  (change)="onFileSelected($event)"
                  accept=".csv"
                  class="hidden"
                >
                <button 
                  (click)="fileInput.click()"
                  [disabled]="loading"
                  class="inline-flex items-center justify-center px-8 py-4 text-base font-medium text-white bg-blue-600 border border-transparent rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
                >
                  <mat-icon class="mr-3 text-xl">folder_open</mat-icon>
                  <span>Sélectionner un fichier CSV</span>
                </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Fichier Sélectionné Premium -->
        <div *ngIf="selectedFile" class="relative">
          <div class="bg-white/90 backdrop-blur-sm border border-emerald-200/50 rounded-3xl p-8 shadow-xl shadow-emerald-500/5 transition-all duration-500 hover:shadow-2xl">
            <!-- Header du fichier -->
            <div class="flex items-start justify-between mb-8">
              <div class="flex items-center gap-6">
                <div class="relative">
                  <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 to-green-600 rounded-2xl flex items-center justify-center shadow-xl">
                    <mat-icon class="text-white text-2xl">description</mat-icon>
                  </div>
                  <!-- Badge de validation -->
                  <div class="absolute -top-2 -right-2 w-8 h-8 bg-blue-500 rounded-full border-3 border-white flex items-center justify-center">
                    <mat-icon class="text-white text-sm">verified</mat-icon>
                  </div>
                </div>
                <div class="space-y-2">
                  <h4 class="text-xl font-semibold text-slate-900 tracking-tight">{{ selectedFile.name }}</h4>
                  <div class="flex items-center gap-4 text-sm text-slate-500">
                    <span class="flex items-center gap-2">
                      <mat-icon class="text-emerald-500 text-base">storage</mat-icon>
                    {{ formatFileSize(selectedFile.size) }}
                    </span>
                    <span class="flex items-center gap-2">
                      <mat-icon class="text-blue-500 text-base">schedule</mat-icon>
                      Maintenant
                    </span>
                  </div>
                  <!-- Status badge -->
                  <div class="inline-flex items-center gap-2 px-3 py-1 bg-emerald-100 text-emerald-800 rounded-full text-xs font-medium">
                    <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                    Fichier validé
                  </div>
                </div>
              </div>
              
              <!-- Bouton de suppression élégant -->
              <button 
                (click)="removeSelectedFile()"
                [disabled]="loading"
                class="group relative w-12 h-12 text-slate-400 hover:text-red-500 bg-white hover:bg-red-50 rounded-2xl border-2 border-slate-200 hover:border-red-200 transition-all duration-300 flex items-center justify-center hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500/20"
              >
                <mat-icon class="transition-transform group-hover:scale-110">close</mat-icon>
              </button>
            </div>
            
            <!-- Aperçu Ultra-Moderne -->
            <div class="relative">
              <div class="absolute inset-0 bg-gradient-to-r from-slate-500/5 to-blue-500/5 rounded-2xl"></div>
              <div class="relative bg-slate-50/50 backdrop-blur-sm border border-slate-200/50 rounded-2xl overflow-hidden">
                <!-- Header de l'aperçu premium -->
                <div class="bg-white/80 backdrop-blur-sm border-b border-slate-200/50 px-8 py-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-6">
                      <div class="w-12 h-12 bg-gradient-to-br from-slate-600 to-slate-700 rounded-xl flex items-center justify-center shadow-lg">
                        <mat-icon class="text-white text-xl">table_view</mat-icon>
                      </div>
                      <div class="space-y-2">
                        <h5 class="text-xl font-semibold text-slate-900 tracking-tight">Aperçu des Données</h5>
                        <p class="text-slate-500">Vérification et validation du contenu importé</p>
                      </div>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-2 rounded-xl border border-blue-200/50">
                        <mat-icon class="text-blue-600 text-lg">assessment</mat-icon>
                        <span class="text-base font-semibold text-blue-700">{{ previewData.length }} entrées</span>
                      </div>
                  </div>
                </div>
              </div>
              
              <!-- Contenu de l'aperçu -->
              <div class="p-0">
                <div *ngIf="previewData.length > 0" class="overflow-x-auto">
                  <div class="min-w-full">
                    <!-- Tableau simple -->
                    <table class="w-full">
                      <thead>
                        <tr class="bg-slate-100 border-b border-slate-200">
                          <th *ngFor="let header of previewHeaders" 
                              class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider border-r border-slate-200 last:border-r-0">
                            {{ header }}
                          </th>
                        </tr>
                      </thead>
                      <tbody class="bg-white divide-y divide-slate-200">
                        <tr *ngFor="let row of previewData; let i = index" 
                            class="hover:bg-blue-50 transition-colors"
                            [class.bg-slate-50]="i % 2 === 0">
                          <td *ngFor="let cell of row" 
                              class="px-6 py-4 text-sm text-gray-800 border-r border-slate-100 last:border-r-0">
                            <span class="truncate max-w-xs block" [title]="cell">{{ cell || '-' }}</span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    
                    <!-- Statistiques Premium -->
                    <div class="bg-gradient-to-r from-white to-slate-50/50 border-t border-slate-200/50 px-8 py-6">
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-8">
                          <div class="flex items-center gap-3 text-slate-600">
                            <div class="w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center">
                              <mat-icon class="text-slate-500">table_rows</mat-icon>
                            </div>
                            <div>
                              <div class="text-lg font-semibold text-slate-900">{{ previewData.length }}</div>
                              <div class="text-xs text-slate-500">Lignes détectées</div>
                            </div>
                          </div>
                          <div class="flex items-center gap-3 text-slate-600">
                            <div class="w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center">
                              <mat-icon class="text-slate-500">view_column</mat-icon>
                            </div>
                            <div>
                              <div class="text-lg font-semibold text-slate-900">{{ previewHeaders.length }}</div>
                              <div class="text-xs text-slate-500">Colonnes validées</div>
                            </div>
                          </div>
                        </div>
                        <div class="flex items-center gap-3 bg-gradient-to-r from-emerald-50 to-green-50 px-6 py-3 rounded-xl border border-emerald-200/50">
                          <div class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></div>
                          <span class="text-emerald-700 font-semibold">Prêt pour import</span>
                          <mat-icon class="text-emerald-500">check_circle</mat-icon>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- État vide élégant -->
                <div *ngIf="previewData.length === 0" class="text-center py-20">
                  <div class="relative mx-auto mb-8">
                    <div class="w-24 h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-3xl flex items-center justify-center mx-auto shadow-lg">
                      <mat-icon class="text-slate-400 text-3xl">description</mat-icon>
                    </div>
                    <div class="absolute -inset-2 bg-gradient-to-r from-slate-200 to-blue-200 rounded-3xl blur opacity-20"></div>
                  </div>
                  <div class="space-y-4">
                    <h6 class="text-2xl font-light text-slate-900">En attente de fichier</h6>
                    <p class="text-slate-500 text-lg max-w-md mx-auto leading-relaxed">
                      Sélectionnez un fichier CSV pour visualiser et valider son contenu avant l'importation
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Espacement entre les sections -->
        <div class="py-6"></div>

        <!-- Résultats d'importation -->
        <div *ngIf="importResults" class="mb-8">
          <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <!-- Header -->
            <div class="bg-blue-50 border-b border-blue-100 p-6">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center">
                  <mat-icon class="text-white text-xl">analytics</mat-icon>
                </div>
                <div>
                  <h3 class="text-2xl font-light text-gray-900">Résultats de l'Importation</h3>
                  <p class="text-gray-500 mt-1">Statistiques d'importation</p>
                </div>
              </div>
            </div>
            
            <!-- Content -->
            <div class="p-6">

            <!-- Statistiques d'importation -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white border border-gray-100 rounded-xl p-4 text-center">
                  <div class="text-2xl font-light text-blue-600 mb-1">{{ importResults.total || 0 }}</div>
                  <div class="text-sm text-gray-600">Total traités</div>
                </div>
                <div class="bg-white border border-gray-100 rounded-xl p-4 text-center">
                  <div class="text-2xl font-light text-green-500 mb-1">{{ importResults.created || 0 }}</div>
                  <div class="text-sm text-gray-600">Créés</div>
              </div>
                <div class="bg-white border border-gray-100 rounded-xl p-4 text-center">
                  <div class="text-2xl font-light text-orange-500 mb-1">{{ importResults.updated || 0 }}</div>
                  <div class="text-sm text-gray-600">Mis à jour</div>
              </div>
                <div class="bg-white border border-gray-100 rounded-xl p-4 text-center">
                  <div class="text-2xl font-light text-red-500 mb-1">{{ importResults.errors || 0 }}</div>
                  <div class="text-sm text-gray-600">Erreurs</div>
              </div>
            </div>

            <!-- Message principal -->
              <div class="bg-blue-50 rounded-xl p-4 text-center mb-6">
                <div class="font-medium text-gray-900">{{ importResults.message }}</div>
            </div>

            <!-- Détails des erreurs (si présentes) -->
              <div *ngIf="importResults.errorDetails && importResults.errorDetails.length > 0" class="bg-red-50 rounded-xl p-4 border border-red-100">
                <h4 class="font-medium text-gray-900 mb-3 flex items-center gap-3">
                  <mat-icon class="text-red-500">error</mat-icon>
                Détails des erreurs
              </h4>
              <div class="space-y-2 max-h-40 overflow-y-auto">
                  <div *ngFor="let errorDetail of importResults.errorDetails" class="text-sm text-gray-700 bg-white rounded-lg p-3 border border-red-100">
                    <span class="font-medium text-red-600">Ligne {{ errorDetail.line }}:</span> {{ errorDetail.message }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions Ultra-Professionnelles -->
        <div class="relative mt-12">
          <div class="absolute inset-0 bg-gradient-to-r from-slate-50/50 to-blue-50/30 rounded-2xl"></div>
          <div class="relative border-t border-slate-200/50 pt-10">
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-6">
              <!-- Action secondaire -->
          <button 
            type="button"
            (click)="goBack()"
            [disabled]="loading"
                class="group inline-flex items-center justify-center px-8 py-4 text-base font-semibold text-slate-700 transition-all duration-300 bg-white border-2 border-slate-200 rounded-2xl hover:bg-slate-50 hover:border-slate-300 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-slate-500/20 disabled:opacity-50"
          >
                <mat-icon class="mr-3 text-xl transition-transform group-hover:-translate-x-1">arrow_back</mat-icon>
                <span>Retour à la liste</span>
          </button>

              <!-- Actions principales -->
              <div class="flex flex-col sm:flex-row gap-4">
            <button 
              type="button"
              (click)="resetImport()"
              [disabled]="loading"
                  class="group inline-flex items-center justify-center px-8 py-4 text-base font-semibold text-orange-700 transition-all duration-300 bg-white border-2 border-orange-200 rounded-2xl hover:bg-orange-50 hover:border-orange-300 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-orange-500/20 disabled:opacity-50"
            >
                  <mat-icon class="mr-3 text-xl transition-transform group-hover:rotate-180">refresh</mat-icon>
                  <span>Réinitialiser</span>
            </button>

                <!-- Bouton principal optimisé -->
            <button 
              type="button"
              (click)="startImport()"
              [disabled]="!selectedFile || loading"
              class="group relative inline-flex items-center justify-center px-10 py-4 text-base font-semibold text-white bg-blue-600 border border-transparent rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
            >
              <mat-spinner *ngIf="loading" diameter="20" class="text-white mr-3"></mat-spinner>
              <mat-icon *ngIf="!loading" class="text-xl mr-3">rocket_launch</mat-icon>
              <span>
                {{ loading ? 'Importation en cours...' : 'Lancer l\'Importation' }}
              </span>
            </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Espacement en bas des boutons -->
    <div class="py-8"></div>

    <!-- Espacement -->
    <div class="py-8"></div>

    <!-- Instructions Professionnelles -->
    <div class="relative">
      <div class="absolute inset-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/50 rounded-3xl opacity-80"></div>
      <div class="relative bg-white/90 backdrop-blur-sm border border-blue-200/50 rounded-3xl p-10 shadow-xl">
        <!-- Header Professionnel -->
        <div class="flex items-center gap-6 mb-10 pb-8 border-b-2 border-blue-200/50">
          <div class="relative group">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-2xl flex items-center justify-center group-hover:scale-105 transition-transform duration-300 shadow-lg">
              <mat-icon class="text-white text-2xl">description</mat-icon>
            </div>
            <!-- Status Indicator -->
            <div class="absolute -top-1 -right-1 w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center border-2 border-white">
              <mat-icon class="text-white text-sm">check</mat-icon>
            </div>
          </div>
          <div class="space-y-3">
            <div class="flex items-center gap-4">
              <h3 class="text-3xl font-black text-slate-900 leading-tight">
                Guide de Format CSV
              </h3>
              <div class="px-4 py-2 bg-blue-50 rounded-full border border-blue-200">
                <span class="text-sm font-bold text-blue-700 uppercase tracking-wider">PRO</span>
              </div>
            </div>
            <p class="text-lg text-slate-600 font-medium max-w-2xl">
              Spécifications techniques et structure requise pour l'importation des étudiants
            </p>
            <div class="flex items-center gap-6">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-emerald-500 rounded-full"></div>
                <span class="text-sm font-semibold text-slate-600">Format validé</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                <span class="text-sm font-semibold text-slate-600">Sécurisé & fiable</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-slate-500 rounded-full"></div>
                <span class="text-sm font-semibold text-slate-600">Interface professionnelle</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Content Professionnel -->
        <div class="space-y-8">
          
          <!-- Spécifications techniques -->
          <div class="bg-white rounded-2xl border border-blue-200 shadow-lg p-8">
            <div class="mb-8">
              <h5 class="text-2xl font-semibold text-slate-900 mb-2">Format CSV attendu</h5>
              <p class="text-slate-600">Le fichier doit contenir les colonnes suivantes :</p>
            </div>
            
            <!-- Format CSV attendu -->
            <div class="mb-6">
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Matricule -->
                <div class="bg-white rounded-lg p-6 border border-slate-200 shadow-sm">
                  <div class="flex items-center gap-4 mb-3">
                    <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                      <span class="text-white text-lg font-bold">M</span>
                    </div>
                    <div>
                      <code class="bg-blue-50 text-blue-700 px-3 py-1 rounded font-mono text-sm font-bold">matricule</code>
                    </div>
                  </div>
                  <p class="text-slate-600 text-sm">Numéro matricule de l'étudiant (obligatoire)</p>
                </div>
                
                <!-- Prénom -->
                <div class="bg-white rounded-lg p-6 border border-slate-200 shadow-sm">
                  <div class="flex items-center gap-4 mb-3">
                    <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                      <span class="text-white text-lg font-bold">P</span>
                    </div>
                    <div>
                      <code class="bg-blue-50 text-blue-700 px-3 py-1 rounded font-mono text-sm font-bold">first_name</code>
                    </div>
                  </div>
                  <p class="text-slate-600 text-sm">Prénom de l'étudiant (obligatoire)</p>
                </div>
                
                <!-- Nom -->
                <div class="bg-white rounded-lg p-6 border border-slate-200 shadow-sm">
                  <div class="flex items-center gap-4 mb-3">
                    <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                      <span class="text-white text-lg font-bold">N</span>
                    </div>
                    <div>
                      <code class="bg-blue-50 text-blue-700 px-3 py-1 rounded font-mono text-sm font-bold">last_name</code>
                    </div>
                  </div>
                  <p class="text-slate-600 text-sm">Nom de famille de l'étudiant (obligatoire)</p>
                </div>
                
                <!-- Email -->
                <div class="bg-white rounded-lg p-6 border border-slate-200 shadow-sm">
                  <div class="flex items-center gap-4 mb-3">
                    <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                      <span class="text-white text-lg font-bold">@</span>
                    </div>
                    <div>
                      <code class="bg-blue-50 text-blue-700 px-3 py-1 rounded font-mono text-sm font-bold">email</code>
                    </div>
                  </div>
                  <p class="text-slate-600 text-sm">Adresse email de l'étudiant (obligatoire)</p>
                </div>
                
                <!-- Password -->
                <div class="bg-white rounded-lg p-6 border border-slate-200 shadow-sm md:col-span-2">
                  <div class="flex items-center gap-4 mb-3">
                    <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                      <span class="text-white text-lg font-bold">🔒</span>
                    </div>
                    <div>
                      <code class="bg-blue-50 text-blue-700 px-3 py-1 rounded font-mono text-sm font-bold">password</code>
                    </div>
                  </div>
                  <p class="text-slate-600 text-sm">Mot de passe de l'étudiant (obligatoire)</p>
                </div>
              </div>
            </div>
            
            <!-- Exemple de fichier CSV -->
            <div class="bg-slate-900 rounded-2xl p-6 overflow-x-auto border border-slate-700">
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class="w-3 h-3 bg-red-400 rounded-full"></div>
                  <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
                  <div class="w-3 h-3 bg-green-400 rounded-full"></div>
                  <span class="text-slate-300 ml-3 font-medium">Exemple de fichier CSV</span>
                </div>
                <button 
                  (click)="copyCSVExample()"
                  class="flex items-center gap-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200"
                >
                  <mat-icon class="text-sm">content_copy</mat-icon>
                  <span class="text-sm">Copier</span>
                </button>
              </div>
              <pre class="text-slate-200 font-mono leading-relaxed text-sm"><code>matricule,first_name,last_name,email,password
ETU2024001,Jean,Dupont,jean.dupont@email.com,password123
ETU2024002,Marie,Martin,marie.martin@email.com,password123
ETU2024003,Pierre,Durand,pierre.durand@email.com,password123</code></pre>
            </div>
            
            <!-- Note -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6">
              <div class="flex items-start gap-3">
                <mat-icon class="text-yellow-600 text-lg mt-0.5">lightbulb</mat-icon>
                <div>
                  <p class="text-yellow-800 text-sm font-medium">
                    <strong>Note :</strong> Les autres informations (promotion, établissement, ville, groupe, option) seront appliquées à tous les étudiants importés selon la configuration ci-dessus.
                  </p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Configuration automatique -->
          <div class="bg-white rounded-2xl border border-green-200 shadow-lg p-8">
            <div class="flex items-start gap-6">
              <div class="w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0">
                <mat-icon class="text-white text-xl">auto_awesome</mat-icon>
              </div>
              <div class="space-y-3">
                <h6 class="text-xl font-semibold text-slate-900">Configuration Automatique</h6>
                <p class="text-slate-600 leading-relaxed font-medium">
                  Les entités liées (promotion, établissement, ville, groupe, option) sont automatiquement 
                  appliquées depuis la base de données. Vous n'avez pas besoin de les inclure dans le CSV.
                </p>
                <div class="flex items-center gap-4">
                  <div class="flex items-center gap-2 px-3 py-1 bg-green-100 rounded-full border border-green-200">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span class="text-sm font-semibold text-green-700">Configuration automatique</span>
                  </div>
                  <div class="flex items-center gap-2 px-3 py-1 bg-blue-100 rounded-full border border-blue-200">
                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                    <span class="text-sm font-semibold text-blue-700">Base de données</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Conseils professionnels -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl p-6 border border-blue-200 shadow-sm hover:shadow-md transition-all duration-300">
              <div class="flex items-center gap-4 mb-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center">
                  <mat-icon class="text-white">lightbulb</mat-icon>
                </div>
                <span class="text-lg font-semibold text-slate-900">Conseil Pro</span>
              </div>
              <p class="text-slate-600 font-medium">La configuration est automatiquement chargée depuis la base de données.</p>
            </div>
            
            <div class="bg-white rounded-xl p-6 border border-green-200 shadow-sm hover:shadow-md transition-all duration-300">
              <div class="flex items-center gap-4 mb-3">
                <div class="w-10 h-10 bg-green-600 rounded-xl flex items-center justify-center">
                  <mat-icon class="text-white">download</mat-icon>
                </div>
                <span class="text-lg font-semibold text-slate-900">Téléchargement</span>
              </div>
              <p class="text-slate-600 font-medium">Le modèle CSV utilise la configuration automatique.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>