<div #sidebarRef 
     class="fixed top-0 left-0 h-screen z-50 overflow-hidden flex flex-col bg-gradient-to-b from-white to-gray-50 border-r border-gray-200 shadow-2xl transition-all duration-300 ease-in-out"
     [ngClass]="{
       'w-72': !isCollapsed && !isMobile, 
       'w-16': isCollapsed && !isMobile,
       'w-80 -translate-x-full': isMobile && isCollapsed,
       'w-80 translate-x-0': isMobile && !isCollapsed
     }"
     [attr.aria-expanded]="!isCollapsed"
     role="navigation"
     aria-label="Navigation principale">
  
  <!-- Header Premium -->
  <div class="sticky top-0 z-10 bg-gradient-to-r from-white via-gray-50 to-white backdrop-blur-xl border-b border-gray-200 min-h-16 flex items-center shadow-md">
    <div class="flex items-center justify-between px-5 py-4 w-full min-h-16"
         [ngClass]="{
           'px-3 justify-center': isCollapsed && !isMobile,
           'px-6': !isCollapsed || isMobile
         }">
      <!-- Logo et branding Premium -->
      <div class="flex items-center gap-4 transition-all duration-300 ease-in-out"
           *ngIf="!isCollapsed || isMobile">
        <div class="relative flex items-center justify-center">
          <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-2xl ring-2 ring-gray-200/50 transition-all duration-300 hover:-translate-y-1 hover:shadow-3xl hover:ring-gray-300/50 hover:scale-105 overflow-hidden hidden">
            <img src="assets/logo_um6ss.png" alt="UM6SS Logo" class="w-full h-full object-contain p-1">
          </div>
          <!-- Effet de brillance -->
          <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-transparent via-white/10 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
        </div>
        <div class="flex flex-col gap-1" *ngIf="!isCollapsed || isMobile">
          <h1 class="text-lg font-bold text-gray-900 leading-tight m-0 drop-shadow-sm hidden">UM6SS</h1>
          <p class="text-xs font-semibold text-gray-600 leading-tight m-0">Gestion Absences</p>
        </div>
      </div>
      
      <!-- Toggle button Premium -->
      <button 
        (click)="toggleSidebar()"
        class="relative w-10 h-10 bg-white rounded-xl cursor-pointer transition-all duration-300 ease border border-gray-300 shadow-md flex items-center justify-center hover:bg-gray-100 hover:border-gray-400 hover:-translate-y-1 hover:shadow-lg hover:scale-105 active:translate-y-0 active:scale-95 focus:outline-none focus:ring-2 focus:ring-gray-400/50 focus:ring-offset-2 focus:ring-offset-white"
        [ngClass]="{
          'mx-auto w-12 h-12': isCollapsed && !isMobile
        }"
        [attr.aria-label]="isCollapsed ? 'Ouvrir le menu' : 'Fermer le menu'"
        [attr.aria-expanded]="!isCollapsed">
        <span class="material-icons text-gray-700 text-lg font-medium transition-all duration-300 ease drop-shadow-sm"
              [ngClass]="{
                'rotate-180': isCollapsed,
                'text-xl': isCollapsed && !isMobile
              }">
          {{ isCollapsed ? 'menu' : 'menu_open' }}
        </span>
        <!-- Effet de brillance sur le bouton -->
        <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-transparent via-white/10 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
      </button>
    </div>
  </div>

  <!-- Navigation Compact -->
  <nav class="flex-1 overflow-y-auto overflow-x-hidden p-0 m-0 pb-20 bg-gradient-to-b from-transparent to-gray-50/50" role="menubar" style="max-height: calc(100vh - 200px);">
    <div class="px-4 py-3 flex flex-col gap-2"
         [ngClass]="{
           'px-2 gap-2': isCollapsed && !isMobile,
           'px-4': !isCollapsed || isMobile
         }">
      <ng-container *ngFor="let item of filteredSidebarItems; let i = index">
        <!-- Élément de navigation -->
        <div class="relative animate-slide-in"
             [style.animation-delay]="getAnimationDelay(i)">
          <button 
            (click)="navigateTo(item.route)"
            (mouseenter)="onItemHover(item.route)"
            (mouseleave)="onItemLeave()"
            (touchstart)="onTouchStart($event)"
            (touchend)="onTouchEnd($event)"
            class="relative w-full h-10 bg-transparent rounded-lg cursor-pointer transition-all duration-300 ease flex items-center my-0.5 hover:bg-gray-100 hover:translate-x-1 hover:shadow-md focus:bg-gray-100 focus:border focus:border-gray-400/50 focus:translate-x-1 focus:outline-none focus:ring-2 focus:ring-gray-400/30 focus:ring-offset-2 focus:ring-offset-white"
            [ngClass]="{
              'bg-gradient-to-r from-gray-100 to-gray-50 border border-gray-400 translate-x-1 shadow-md': isActiveRoute(item.route),
              'hover:bg-gray-100': hoveredItem === item.route,
              'opacity-40 cursor-not-allowed pointer-events-none': item.disabled,
              'justify-center px-3': isCollapsed && !isMobile,
              'justify-start px-4': !isCollapsed || isMobile
            }"
            [title]="getTooltipText(item)"
            [attr.aria-label]="item.label"
            [attr.aria-current]="isActiveRoute(item.route) ? 'page' : null"
            [attr.data-route]="item.route"
            role="menuitem"
            [disabled]="item.disabled">
            
            <!-- Container principal Compact -->
            <div class="flex items-center gap-3 w-full relative z-10"
                 [ngClass]="{
                   'justify-center gap-0': isCollapsed && !isMobile,
                   'justify-start gap-3': !isCollapsed || isMobile
                 }">
              <!-- Icône Compact -->
              <div class="relative flex items-center justify-center flex-shrink-0"
                   [ngClass]="{
                     'w-9 h-9 mx-auto': isCollapsed && !isMobile,
                     'w-7 h-7': !isCollapsed || isMobile
                   }">
                <div class="w-full h-full bg-white rounded-lg flex items-center justify-center transition-all duration-300 ease border border-gray-200 shadow-sm"
                     [ngClass]="{
                       'hover:bg-gray-100 hover:border-gray-300 hover:shadow-md': true,
                       'focus:bg-gray-100 focus:border-gray-400/50 focus:shadow-md': true,
                       'bg-gray-200 border-gray-400 shadow-md': isActiveRoute(item.route),
                       'rounded-lg': isCollapsed && !isMobile
                     }">
                  <span class="material-icons text-gray-600 transition-all duration-300 ease drop-shadow-sm"
                        [ngClass]="{
                          'hover:text-gray-900': true,
                          'text-gray-900': isActiveRoute(item.route),
                          'text-xl': isCollapsed && !isMobile,
                          'text-lg': !isCollapsed || isMobile
                        }">{{ item.icon }}</span>
                </div>
                <!-- Effet de brillance sur l'icône -->
                <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"
                     [ngClass]="{
                       'rounded-lg': isCollapsed && !isMobile
                     }"></div>
              </div>
              
              <!-- Contenu textuel Premium -->
              <div class="flex items-center justify-between flex-1 min-w-0" 
                   *ngIf="!isCollapsed || isMobile">
                <span class="text-sm font-semibold text-gray-700 leading-snug transition-all duration-300 ease drop-shadow-sm"
                      [ngClass]="{
                        'hover:text-gray-900 hover:font-bold': true,
                        'text-gray-900 font-bold': isActiveRoute(item.route)
                      }">{{ item.label }}</span>
                <span *ngIf="item.badge" 
                      class="inline-flex items-center px-3 py-1.5 text-xs font-bold bg-gradient-to-r from-red-100 to-pink-100 text-red-700 rounded-full border border-red-300 shadow-md animate-pulse"
                      [attr.aria-label]="'Badge: ' + item.badge">
                  {{ item.badge }}
                </span>
              </div>
            </div>
            
            <!-- Indicateur de sélection Premium -->
            <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-8 bg-gradient-to-b from-gray-700 to-gray-800 rounded-r-lg opacity-0 transition-all duration-300 ease shadow-lg"
                 [ngClass]="{
                   'opacity-100': isActiveRoute(item.route)
                 }"></div>
          </button>
        </div>
      </ng-container>
    </div>
  </nav>

  <!-- Footer utilisateur Compact -->
  <div class="absolute bottom-0 left-0 right-0 z-10 bg-gradient-to-r from-white via-gray-50 to-white backdrop-blur-xl border-t border-gray-200 shadow-lg">
    <div class="px-3 py-2"
         [ngClass]="{
           'px-2': isCollapsed && !isMobile,
           'px-3': !isCollapsed || isMobile
         }">
      
      <!-- Mode normal (non collapsed) -->
      <div *ngIf="!isCollapsed || isMobile" class="space-y-1">
        <!-- Profil utilisateur Ultra-Compact -->
        <div class="bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 overflow-hidden shadow-md">
          <!-- Profil vertical compact -->
          <div class="flex items-start gap-2 p-2">
            <!-- Avatar Mini -->
            <div class="relative flex-shrink-0">
              <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg ring-1 ring-blue-400/20 transition-all duration-200">
                <span class="material-icons text-white text-sm drop-shadow-sm">{{ userData.avatar }}</span>
              </div>
              <!-- Indicateur de statut Mini -->
              <div class="absolute -bottom-0.5 -right-0.5 w-2 h-2 bg-emerald-400 border border-white rounded-full shadow-sm animate-pulse"></div>
            </div>
            
            <!-- Informations utilisateur verticales -->
            <div class="flex-1 min-w-0">
              <!-- Nom et prénom en haut -->
              <h3 class="text-xs font-bold text-gray-900 leading-tight m-0 truncate drop-shadow-sm">
                {{ userData.name }}
              </h3>
              
              <!-- Email juste en dessous -->
              <p *ngIf="userData.email" class="text-xs text-gray-600 leading-tight m-0 truncate -mt-0.5">
                {{ userData.email }}
              </p>
              
              <!-- Rôle en dernier -->
              <div class="flex items-center gap-1 mt-1">
                <span class="material-icons text-gray-600 text-xs drop-shadow-sm">verified_user</span>
                <span class="text-xs font-medium text-gray-700 bg-gray-100 px-1.5 py-0.5 rounded border border-gray-300">
                  {{ userData.role }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions utilisateur Compactes -->
        <div class="flex items-center gap-2">
          <button 
            (click)="navigateToProfile()"
            class="flex-1 h-9 bg-white rounded-lg cursor-pointer transition-all duration-300 ease flex items-center justify-center gap-2 hover:bg-gray-100 hover:scale-105 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-400/50 focus:ring-offset-2 focus:ring-offset-white border border-gray-300 hover:border-gray-400 shadow-sm" 
            title="Voir le profil">
            <span class="material-icons text-gray-700 text-sm drop-shadow-sm">person</span>
            <span class="text-xs font-semibold text-gray-700 drop-shadow-sm">Profil</span>
          </button>
          
          <button 
            (click)="logout()"
            class="flex-1 h-9 bg-red-50 rounded-lg cursor-pointer transition-all duration-300 ease flex items-center justify-center gap-2 hover:bg-red-100 hover:scale-105 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-red-400/50 focus:ring-offset-2 focus:ring-offset-white border border-red-200 hover:border-red-300 shadow-sm" 
            title="Se déconnecter">
            <span class="material-icons text-red-700 text-sm drop-shadow-sm">logout</span>
            <span class="text-xs font-semibold text-red-700 drop-shadow-sm">Déconnexion</span>
          </button>
        </div>
      </div>

      <!-- Mode collapsed Ultra-Compact -->
      <div *ngIf="isCollapsed && !isMobile" class="flex flex-col items-center space-y-1">
        <!-- Avatar Ultra-Compact avec tooltip -->
        <div class="relative group">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg ring-1 ring-blue-400/20 hover:ring-blue-400/40 transition-all duration-200 cursor-pointer">
            <span class="material-icons text-white text-sm drop-shadow-sm">{{ userData.avatar }}</span>
          </div>
          <!-- Indicateur de statut Mini -->
          <div class="absolute -bottom-0.5 -right-0.5 w-2 h-2 bg-emerald-400 border border-white rounded-full shadow-sm animate-pulse"></div>
          
          <!-- Tooltip Ultra-Compact -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-1 bg-white backdrop-blur-sm text-gray-900 text-xs rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-all duration-200 pointer-events-none z-50 border border-gray-300 min-w-32">
            <div class="text-center">
              <!-- Nom et prénom en haut -->
              <div class="font-bold text-gray-900 text-xs">{{ userData.name }}</div>
              
              <!-- Email juste en dessous -->
              <div *ngIf="userData.email" class="text-gray-600 text-xs truncate max-w-28 -mt-0.5">
                {{ userData.email }}
              </div>
              
              <!-- Rôle en dernier -->
              <div class="flex items-center justify-center gap-1 mt-1">
                <span class="material-icons text-gray-600 text-xs">verified_user</span>
                <span class="text-gray-700 text-xs">{{ userData.role }}</span>
              </div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-3 border-r-3 border-t-3 border-transparent border-t-white"></div>
          </div>
        </div>

        <!-- Boutons d'action ultra-compacts -->
        <div class="flex flex-col gap-1 w-full">
          <button 
            (click)="navigateToProfile()"
            class="w-full h-6 bg-white rounded-md cursor-pointer transition-all duration-200 ease flex items-center justify-center hover:bg-gray-100 hover:scale-105 hover:shadow-md focus:outline-none focus:ring-1 focus:ring-gray-400/50 focus:ring-offset-1 focus:ring-offset-white border border-gray-300 hover:border-gray-400 shadow-sm" 
            title="Voir le profil">
            <span class="material-icons text-gray-700 text-xs">person</span>
          </button>
          
          <button 
            (click)="logout()"
            class="w-full h-6 bg-red-50 rounded-md cursor-pointer transition-all duration-200 ease flex items-center justify-center hover:bg-red-100 hover:scale-105 hover:shadow-md focus:outline-none focus:ring-1 focus:ring-red-400/50 focus:ring-offset-1 focus:ring-offset-white border border-red-200 hover:border-red-300 shadow-sm" 
            title="Se déconnecter">
            <span class="material-icons text-red-700 text-xs">logout</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Overlay pour mobile -->
<div *ngIf="isMobile && !isCollapsed" 
     class="fixed top-0 left-0 right-0 bottom-0 bg-black bg-opacity-50 z-40 backdrop-blur-sm"
     (click)="toggleSidebar()"
     [attr.aria-hidden]="true">
</div>
