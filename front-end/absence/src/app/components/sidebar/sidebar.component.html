<div #sidebarRef 
     class="fixed top-0 left-0 h-screen z-50 overflow-y-auto overflow-x-hidden bg-gray-900 border-r border-gray-700 shadow-xl transition-all duration-300 ease-in-out"
     [ngClass]="{
       'w-72': !isCollapsed && !isMobile, 
       'w-16': isCollapsed && !isMobile,
       'w-80 -translate-x-full': isMobile && isCollapsed,
       'w-80 translate-x-0': isMobile && !isCollapsed
     }"
     [attr.aria-expanded]="!isCollapsed"
     role="navigation"
     aria-label="Navigation principale">
  
  <!-- Header Premium -->
  <div class="sticky top-0 z-10 bg-gradient-to-r from-slate-900/95 via-gray-900/95 to-slate-800/95 backdrop-blur-xl border-b border-slate-700/50 min-h-16 flex items-center shadow-2xl">
    <div class="flex items-center justify-between px-5 py-4 w-full min-h-16"
         [ngClass]="{
           'px-3 justify-center': isCollapsed && !isMobile,
           'px-6': !isCollapsed || isMobile
         }">
      <!-- Logo et branding Premium -->
      <div class="flex items-center gap-4 transition-all duration-300 ease-in-out"
           *ngIf="!isCollapsed || isMobile">
        <div class="relative flex items-center justify-center">
          <div class="w-12 h-12 bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-2xl ring-2 ring-blue-400/20 transition-all duration-300 hover:-translate-y-1 hover:shadow-3xl hover:ring-blue-400/40 hover:scale-105">
            <span class="material-icons text-white text-xl drop-shadow-lg">school</span>
          </div>
          <!-- Effet de brillance -->
          <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-transparent via-white/10 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
        </div>
        <div class="flex flex-col gap-1" *ngIf="!isCollapsed || isMobile">
          <h1 class="text-lg font-bold text-white leading-tight m-0 drop-shadow-sm bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">UM6SS</h1>
          <p class="text-xs font-semibold text-slate-300 leading-tight m-0">Gestion Absences</p>
        </div>
      </div>
      
      <!-- Toggle button Premium -->
      <button 
        (click)="toggleSidebar()"
        class="relative w-10 h-10 bg-gradient-to-br from-slate-700/80 to-slate-600/80 backdrop-blur-sm rounded-xl cursor-pointer transition-all duration-300 ease border border-slate-600/50 shadow-xl flex items-center justify-center hover:from-slate-600 hover:to-slate-500 hover:border-slate-500/70 hover:-translate-y-1 hover:shadow-2xl hover:scale-105 active:translate-y-0 active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:ring-offset-2 focus:ring-offset-slate-900"
        [ngClass]="{
          'mx-auto w-12 h-12': isCollapsed && !isMobile
        }"
        [attr.aria-label]="isCollapsed ? 'Ouvrir le menu' : 'Fermer le menu'"
        [attr.aria-expanded]="!isCollapsed">
        <span class="material-icons text-slate-200 text-lg font-medium transition-all duration-300 ease drop-shadow-sm"
              [ngClass]="{
                'rotate-180': isCollapsed,
                'text-xl': isCollapsed && !isMobile
              }">
          {{ isCollapsed ? 'menu' : 'menu_open' }}
        </span>
        <!-- Effet de brillance sur le bouton -->
        <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
      </button>
    </div>
  </div>

  <!-- Navigation Compact -->
  <nav class="flex-1 p-0 m-0 pb-20 bg-gradient-to-b from-transparent to-slate-900/20" role="menubar">
    <div class="px-4 py-3 flex flex-col gap-2"
         [ngClass]="{
           'px-2 gap-2': isCollapsed && !isMobile,
           'px-4': !isCollapsed || isMobile
         }">
      <ng-container *ngFor="let item of filteredSidebarItems; let i = index">
        <!-- Élément de navigation -->
        <div class="relative animate-slide-in"
             [style.animation-delay]="getAnimationDelay(i)">
          <button 
            (click)="navigateTo(item.route)"
            (mouseenter)="onItemHover(item.route)"
            (mouseleave)="onItemLeave()"
            (touchstart)="onTouchStart($event)"
            (touchend)="onTouchEnd($event)"
            class="relative w-full h-10 bg-transparent rounded-lg cursor-pointer transition-all duration-300 ease flex items-center my-0.5 hover:bg-slate-800/60 hover:translate-x-1 hover:shadow-lg focus:bg-slate-700/80 focus:border focus:border-blue-400/50 focus:translate-x-1 focus:outline-none focus:ring-2 focus:ring-blue-400/30 focus:ring-offset-2 focus:ring-offset-slate-900 backdrop-blur-sm"
            [ngClass]="{
              'bg-gradient-to-r from-blue-600/20 to-indigo-600/20 border border-blue-400/30 translate-x-1 shadow-lg backdrop-blur-sm': isActiveRoute(item.route),
              'hover:bg-slate-800/60': hoveredItem === item.route,
              'opacity-40 cursor-not-allowed pointer-events-none': item.disabled,
              'justify-center px-3': isCollapsed && !isMobile,
              'justify-start px-4': !isCollapsed || isMobile
            }"
            [title]="getTooltipText(item)"
            [attr.aria-label]="item.label"
            [attr.aria-current]="isActiveRoute(item.route) ? 'page' : null"
            [attr.data-route]="item.route"
            role="menuitem"
            [disabled]="item.disabled">
            
            <!-- Container principal Compact -->
            <div class="flex items-center gap-3 w-full relative z-10"
                 [ngClass]="{
                   'justify-center gap-0': isCollapsed && !isMobile,
                   'justify-start gap-3': !isCollapsed || isMobile
                 }">
              <!-- Icône Compact -->
              <div class="relative flex items-center justify-center flex-shrink-0"
                   [ngClass]="{
                     'w-9 h-9 mx-auto': isCollapsed && !isMobile,
                     'w-7 h-7': !isCollapsed || isMobile
                   }">
                <div class="w-full h-full bg-gradient-to-br from-slate-700/80 to-slate-600/80 backdrop-blur-sm rounded-lg flex items-center justify-center transition-all duration-300 ease border border-slate-600/50 shadow-lg"
                     [ngClass]="{
                       'hover:from-slate-600 hover:to-slate-500 hover:border-slate-500/70 hover:shadow-xl': true,
                       'focus:from-slate-600 focus:to-slate-500 focus:border-blue-400/50 focus:shadow-xl': true,
                       'from-blue-600/80 to-indigo-600/80 border-blue-400/50 shadow-xl': isActiveRoute(item.route),
                       'rounded-lg': isCollapsed && !isMobile
                     }">
                  <span class="material-icons text-slate-300 transition-all duration-300 ease drop-shadow-sm"
                        [ngClass]="{
                          'hover:text-white': true,
                          'text-white': isActiveRoute(item.route),
                          'text-xl': isCollapsed && !isMobile,
                          'text-lg': !isCollapsed || isMobile
                        }">{{ item.icon }}</span>
                </div>
                <!-- Effet de brillance sur l'icône -->
                <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"
                     [ngClass]="{
                       'rounded-lg': isCollapsed && !isMobile
                     }"></div>
              </div>
              
              <!-- Contenu textuel Premium -->
              <div class="flex items-center justify-between flex-1 min-w-0" 
                   *ngIf="!isCollapsed || isMobile">
                <span class="text-sm font-semibold text-slate-300 leading-snug transition-all duration-300 ease drop-shadow-sm"
                      [ngClass]="{
                        'hover:text-white hover:font-bold': true,
                        'text-white font-bold bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent': isActiveRoute(item.route)
                      }">{{ item.label }}</span>
                <span *ngIf="item.badge" 
                      class="inline-flex items-center px-3 py-1.5 text-xs font-bold bg-gradient-to-r from-red-500/20 to-pink-500/20 text-red-300 rounded-full border border-red-400/30 shadow-lg backdrop-blur-sm animate-pulse"
                      [attr.aria-label]="'Badge: ' + item.badge">
                  {{ item.badge }}
                </span>
              </div>
            </div>
            
            <!-- Indicateur de sélection Premium -->
            <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-8 bg-gradient-to-b from-blue-400 to-indigo-500 rounded-r-lg opacity-0 transition-all duration-300 ease shadow-lg"
                 [ngClass]="{
                   'opacity-100': isActiveRoute(item.route)
                 }"></div>
          </button>
        </div>
      </ng-container>
    </div>
  </nav>

  <!-- Footer utilisateur Compact -->
  <div class="absolute bottom-0 left-0 right-0 z-10 bg-gradient-to-r from-slate-900/95 via-gray-900/95 to-slate-800/95 backdrop-blur-xl border-t border-slate-700/50 shadow-2xl">
    <div class="px-3 py-2"
         [ngClass]="{
           'px-2': isCollapsed && !isMobile,
           'px-3': !isCollapsed || isMobile
         }">
      
      <!-- Mode normal (non collapsed) -->
      <div *ngIf="!isCollapsed || isMobile" class="space-y-1">
        <!-- Profil utilisateur Ultra-Compact -->
        <div class="bg-gradient-to-r from-slate-800/60 to-slate-700/40 backdrop-blur-sm rounded-lg border border-slate-600/30 hover:border-slate-500/50 transition-all duration-200 overflow-hidden shadow-lg">
          <!-- Profil vertical compact -->
          <div class="flex items-start gap-2 p-2">
            <!-- Avatar Mini -->
            <div class="relative flex-shrink-0">
              <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg ring-1 ring-blue-400/20 transition-all duration-200">
                <span class="material-icons text-white text-sm drop-shadow-sm">{{ userData.avatar }}</span>
              </div>
              <!-- Indicateur de statut Mini -->
              <div class="absolute -bottom-0.5 -right-0.5 w-2 h-2 bg-emerald-400 border border-slate-900 rounded-full shadow-sm animate-pulse"></div>
            </div>
            
            <!-- Informations utilisateur verticales -->
            <div class="flex-1 min-w-0">
              <!-- Nom et prénom en haut -->
              <h3 class="text-xs font-bold text-white leading-tight m-0 truncate drop-shadow-sm">
                {{ userData.name }}
              </h3>
              
              <!-- Email juste en dessous -->
              <p *ngIf="userData.email" class="text-xs text-slate-400 leading-tight m-0 truncate -mt-0.5">
                {{ userData.email }}
              </p>
              
              <!-- Rôle en dernier -->
              <div class="flex items-center gap-1 mt-1">
                <span class="material-icons text-blue-400 text-xs drop-shadow-sm">verified_user</span>
                <span class="text-xs font-medium text-blue-300 bg-blue-500/10 px-1.5 py-0.5 rounded border border-blue-400/20">
                  {{ userData.role }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions utilisateur Compactes -->
        <div class="flex items-center gap-2">
          <button 
            (click)="navigateToProfile()"
            class="flex-1 h-9 bg-gradient-to-r from-slate-700/90 to-slate-600/90 backdrop-blur-xl rounded-lg cursor-pointer transition-all duration-300 ease flex items-center justify-center gap-2 hover:from-slate-600 hover:to-slate-500 hover:scale-105 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:ring-offset-2 focus:ring-offset-slate-900 border border-slate-600/50 hover:border-slate-500/70 shadow-lg" 
            title="Voir le profil">
            <span class="material-icons text-slate-300 text-sm drop-shadow-sm">person</span>
            <span class="text-xs font-semibold text-slate-300 drop-shadow-sm">Profil</span>
          </button>
          
          <button 
            (click)="logout()"
            class="flex-1 h-9 bg-gradient-to-r from-red-600/90 to-red-700/90 backdrop-blur-xl rounded-lg cursor-pointer transition-all duration-300 ease flex items-center justify-center gap-2 hover:from-red-700 hover:to-red-800 hover:scale-105 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-red-400/50 focus:ring-offset-2 focus:ring-offset-slate-900 border border-red-500/50 hover:border-red-400/70 shadow-lg" 
            title="Se déconnecter">
            <span class="material-icons text-white text-sm drop-shadow-sm">logout</span>
            <span class="text-xs font-semibold text-white drop-shadow-sm">Déconnexion</span>
          </button>
        </div>
      </div>

      <!-- Mode collapsed Ultra-Compact -->
      <div *ngIf="isCollapsed && !isMobile" class="flex flex-col items-center space-y-1">
        <!-- Avatar Ultra-Compact avec tooltip -->
        <div class="relative group">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg ring-1 ring-blue-400/20 hover:ring-blue-400/40 transition-all duration-200 cursor-pointer">
            <span class="material-icons text-white text-sm drop-shadow-sm">{{ userData.avatar }}</span>
          </div>
          <!-- Indicateur de statut Mini -->
          <div class="absolute -bottom-0.5 -right-0.5 w-2 h-2 bg-emerald-400 border border-slate-900 rounded-full shadow-sm animate-pulse"></div>
          
          <!-- Tooltip Ultra-Compact -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-1 bg-gray-900/95 backdrop-blur-sm text-white text-xs rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-all duration-200 pointer-events-none z-50 border border-gray-600/50 min-w-32">
            <div class="text-center">
              <!-- Nom et prénom en haut -->
              <div class="font-bold text-white text-xs">{{ userData.name }}</div>
              
              <!-- Email juste en dessous -->
              <div *ngIf="userData.email" class="text-gray-400 text-xs truncate max-w-28 -mt-0.5">
                {{ userData.email }}
              </div>
              
              <!-- Rôle en dernier -->
              <div class="flex items-center justify-center gap-1 mt-1">
                <span class="material-icons text-blue-400 text-xs">verified_user</span>
                <span class="text-blue-300 text-xs">{{ userData.role }}</span>
              </div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-3 border-r-3 border-t-3 border-transparent border-t-gray-900/95"></div>
          </div>
        </div>

        <!-- Boutons d'action ultra-compacts -->
        <div class="flex flex-col gap-1 w-full">
          <button 
            (click)="navigateToProfile()"
            class="w-full h-6 bg-gradient-to-r from-slate-700/80 to-slate-600/80 backdrop-blur-sm rounded-md cursor-pointer transition-all duration-200 ease flex items-center justify-center hover:from-slate-600 hover:to-slate-500 hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-1 focus:ring-blue-400/50 focus:ring-offset-1 focus:ring-offset-slate-900 border border-slate-600/40 hover:border-slate-500/60 shadow-md" 
            title="Voir le profil">
            <span class="material-icons text-slate-300 text-xs">person</span>
          </button>
          
          <button 
            (click)="logout()"
            class="w-full h-6 bg-gradient-to-r from-red-600/90 to-red-700/90 backdrop-blur-sm rounded-md cursor-pointer transition-all duration-200 ease flex items-center justify-center hover:from-red-700 hover:to-red-800 hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-1 focus:ring-red-400/50 focus:ring-offset-1 focus:ring-offset-slate-900 border border-red-500/40 hover:border-red-400/60 shadow-md" 
            title="Se déconnecter">
            <span class="material-icons text-white text-xs">logout</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Overlay pour mobile -->
<div *ngIf="isMobile && !isCollapsed" 
     class="fixed top-0 left-0 right-0 bottom-0 bg-black bg-opacity-50 z-40 backdrop-blur-sm"
     (click)="toggleSidebar()"
     [attr.aria-hidden]="true">
</div>
