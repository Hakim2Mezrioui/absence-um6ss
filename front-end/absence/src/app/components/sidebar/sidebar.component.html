<div #sidebarRef 
     class="fixed top-0 left-0 h-screen z-50 overflow-y-auto overflow-x-hidden bg-gray-900 border-r border-gray-700 shadow-xl transition-all duration-300 ease-in-out"
     [ngClass]="{
       'w-72': !isCollapsed && !isMobile, 
       'w-16': isCollapsed && !isMobile,
       'w-80 -translate-x-full': isMobile && isCollapsed,
       'w-80 translate-x-0': isMobile && !isCollapsed
     }"
     [attr.aria-expanded]="!isCollapsed"
     role="navigation"
     aria-label="Navigation principale">
  
  <!-- Header -->
  <div class="sticky top-0 z-10 bg-gray-800 border-b border-gray-700 min-h-16 flex items-center">
    <div class="flex items-center justify-between px-5 py-4 w-full min-h-16"
         [ngClass]="{
           'px-3 justify-center': isCollapsed && !isMobile,
           'px-6': !isCollapsed || isMobile
         }">
      <!-- Logo et branding -->
      <div class="flex items-center gap-4 transition-all duration-300 ease-in-out"
           *ngIf="!isCollapsed || isMobile">
        <div class="relative flex items-center justify-center">
          <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg transition-all duration-200 hover:-translate-y-0.5 hover:shadow-xl">
            <span class="material-icons text-white text-xl">school</span>
          </div>
        </div>
        <div class="flex flex-col gap-0.5" *ngIf="!isCollapsed || isMobile">
          <h1 class="text-base font-semibold text-white leading-tight m-0">UM6SS</h1>
          <p class="text-xs font-medium text-gray-300 leading-tight m-0">Gestion Absences</p>
        </div>
      </div>
      
      <!-- Toggle button -->
      <button 
        (click)="toggleSidebar()"
        class="relative w-9 h-9 bg-gray-700 rounded-lg cursor-pointer transition-all duration-200 ease border border-gray-600 shadow-lg flex items-center justify-center hover:bg-gray-600 hover:border-gray-500 hover:-translate-y-0.5 hover:shadow-xl active:translate-y-0 active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-gray-800"
        [ngClass]="{
          'mx-auto w-11 h-11': isCollapsed && !isMobile
        }"
        [attr.aria-label]="isCollapsed ? 'Ouvrir le menu' : 'Fermer le menu'"
        [attr.aria-expanded]="!isCollapsed">
        <span class="material-icons text-gray-300 text-lg font-medium transition-all duration-200 ease"
              [ngClass]="{
                'rotate-180': isCollapsed,
                'text-xl': isCollapsed && !isMobile
              }">
          {{ isCollapsed ? 'menu' : 'menu_open' }}
        </span>
      </button>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 p-0 m-0 pb-24" role="menubar">
    <div class="px-5 py-6 flex flex-col gap-2"
         [ngClass]="{
           'px-3 gap-3': isCollapsed && !isMobile,
           'px-6': !isCollapsed || isMobile
         }">
      <ng-container *ngFor="let item of sidebarItems; let i = index">
        <!-- Élément de navigation -->
        <div class="relative animate-slide-in"
             [style.animation-delay]="getAnimationDelay(i)">
          <button 
            (click)="navigateTo(item.route)"
            (mouseenter)="onItemHover(item.route)"
            (mouseleave)="onItemLeave()"
            (touchstart)="onTouchStart($event)"
            (touchend)="onTouchEnd($event)"
            class="relative w-full h-11 bg-transparent rounded-lg cursor-pointer transition-all duration-200 ease flex items-center my-0.5 hover:bg-gray-800 hover:translate-x-0.5 focus:bg-gray-700 focus:border focus:border-blue-400 focus:translate-x-0.5 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-gray-900"
            [ngClass]="{
              'bg-gray-800 border border-gray-600 translate-x-0.5': isActiveRoute(item.route),
              'hover:bg-gray-800': hoveredItem === item.route,
              'opacity-40 cursor-not-allowed pointer-events-none': item.disabled,
              'justify-center px-2': isCollapsed && !isMobile,
              'justify-start px-3': !isCollapsed || isMobile
            }"
            [title]="getTooltipText(item)"
            [attr.aria-label]="item.label"
            [attr.aria-current]="isActiveRoute(item.route) ? 'page' : null"
            [attr.data-route]="item.route"
            role="menuitem"
            [disabled]="item.disabled">
            
            <!-- Container principal -->
            <div class="flex items-center gap-3 w-full relative z-10"
                 [ngClass]="{
                   'justify-center gap-0': isCollapsed && !isMobile,
                   'justify-start gap-3': !isCollapsed || isMobile
                 }">
              <!-- Icône -->
              <div class="relative flex items-center justify-center flex-shrink-0"
                   [ngClass]="{
                     'w-10 h-10 mx-auto': isCollapsed && !isMobile,
                     'w-7 h-7': !isCollapsed || isMobile
                   }">
                <div class="w-full h-full bg-gray-700 rounded-md flex items-center justify-center transition-all duration-200 ease border border-gray-600"
                     [ngClass]="{
                       'hover:bg-gray-600 hover:border-gray-500': true,
                       'focus:bg-gray-600 focus:border-blue-400': true,
                       'bg-gray-600 border-gray-500': isActiveRoute(item.route),
                       'rounded-xl': isCollapsed && !isMobile
                     }">
                  <span class="material-icons text-gray-300 transition-all duration-200 ease"
                        [ngClass]="{
                          'hover:text-white': true,
                          'text-white': isActiveRoute(item.route),
                          'text-xl': isCollapsed && !isMobile,
                          'text-lg': !isCollapsed || isMobile
                        }">{{ item.icon }}</span>
                </div>
              </div>
              
              <!-- Contenu textuel -->
              <div class="flex items-center justify-between flex-1 min-w-0" 
                   *ngIf="!isCollapsed || isMobile">
                <span class="text-sm font-medium text-gray-300 leading-snug transition-all duration-200 ease"
                      [ngClass]="{
                        'hover:text-white hover:font-semibold': true,
                        'text-white font-bold': isActiveRoute(item.route)
                      }">{{ item.label }}</span>
                <span *ngIf="item.badge" 
                      class="inline-flex items-center px-2.5 py-1 text-xs font-semibold bg-red-100 text-red-600 rounded-full border border-red-200 shadow-sm animate-pulse"
                      [attr.aria-label]="'Badge: ' + item.badge">
                  {{ item.badge }}
                </span>
              </div>
            </div>
            
            <!-- Indicateur de sélection -->
            <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-0.5 h-5 bg-blue-400 rounded-r-sm opacity-0 transition-all duration-200 ease"
                 [ngClass]="{
                   'opacity-100': isActiveRoute(item.route)
                 }"></div>
          </button>
        </div>
      </ng-container>
    </div>
  </nav>

  <!-- Footer utilisateur -->
  <div class="absolute bottom-0 left-0 right-0 z-10 bg-gray-800 border-t border-gray-700 shadow-xl">
    <div class="px-5 py-4 flex items-center justify-between"
         [ngClass]="{
           'px-3 justify-center': isCollapsed && !isMobile,
           'px-6': !isCollapsed || isMobile
         }">
      <!-- Profil utilisateur -->
      <div class="flex items-center gap-3 transition-all duration-300 ease-in-out"
           [ngClass]="{
             'gap-0 justify-center': isCollapsed && !isMobile
           }">
        <div class="relative flex items-center justify-center">
          <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg transition-all duration-200 hover:-translate-y-0.5 hover:shadow-xl">
            <span class="material-icons text-white text-lg">person</span>
          </div>
          <div class="absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-green-400 border-2 border-gray-800 rounded-full shadow-sm"></div>
        </div>
        <div class="flex flex-col gap-0.5 min-w-0" *ngIf="!isCollapsed || isMobile">
          <p class="text-sm font-semibold text-white leading-tight m-0 whitespace-nowrap overflow-hidden text-ellipsis">Administrateur</p>
          <p class="text-xs font-medium text-gray-300 leading-tight m-0 whitespace-nowrap overflow-hidden text-ellipsis">Admin System</p>
        </div>
      </div>
      
      <!-- Actions utilisateur -->
      <div class="flex items-center gap-1.5" *ngIf="!isCollapsed || isMobile">
        <button class="w-8 h-8 bg-transparent rounded-md cursor-pointer transition-all duration-200 ease flex items-center justify-center hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-gray-800" title="Paramètres">
          <div class="w-full h-full bg-gray-700 rounded-md flex items-center justify-center transition-all duration-200 ease border border-gray-600 hover:bg-blue-600 hover:border-blue-400 focus:bg-blue-600 focus:border-blue-400">
            <span class="material-icons text-gray-300 text-base transition-all duration-200 ease hover:text-white">settings</span>
          </div>
        </button>
        <button class="w-8 h-8 bg-transparent rounded-md cursor-pointer transition-all duration-200 ease flex items-center justify-center hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 focus:ring-offset-gray-800" title="Déconnexion">
          <div class="w-full h-full bg-gray-700 rounded-md flex items-center justify-center transition-all duration-200 ease border border-gray-600 hover:bg-red-600 hover:border-red-400 focus:bg-red-600 focus:border-red-400">
            <span class="material-icons text-gray-300 text-base transition-all duration-200 ease hover:text-white">logout</span>
          </div>
        </button>
      </div>
      
      <!-- Menu compact pour mode collapsed -->
      <div class="flex items-center justify-center" *ngIf="isCollapsed && !isMobile">
        <button class="w-9 h-9 bg-gradient-to-br from-gray-700 to-gray-600 rounded-lg cursor-pointer transition-all duration-300 ease flex items-center justify-center border border-gray-600 hover:scale-105 hover:from-gray-600 hover:to-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-gray-800" title="Menu utilisateur">
          <div class="flex flex-col gap-0.5">
            <span class="w-1 h-1 bg-gray-300 rounded-full transition-all duration-300 ease hover:bg-white hover:scale-125"></span>
            <span class="w-1 h-1 bg-gray-300 rounded-full transition-all duration-300 ease hover:bg-white hover:scale-125"></span>
            <span class="w-1 h-1 bg-gray-300 rounded-full transition-all duration-300 ease hover:bg-white hover:scale-125"></span>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Overlay pour mobile -->
<div *ngIf="isMobile && !isCollapsed" 
     class="fixed top-0 left-0 right-0 bottom-0 bg-black bg-opacity-50 z-40 backdrop-blur-sm"
     (click)="toggleSidebar()"
     [attr.aria-hidden]="true">
</div>
