<div class="h-screen flex flex-col bg-slate-50">
  <!-- ===== HEADER SECTION ===== -->
  <div class="flex-shrink-0 bg-white border-b border-slate-200 shadow-sm">
    <div class="max-w-full px-6 py-4">
      <div class="flex items-center justify-between gap-4">
        <div class="flex items-center gap-4">
          <h1 class="text-2xl font-semibold text-slate-900">Attendance Rapide</h1>
          <span *ngIf="tableRows.length" class="text-sm text-slate-600">{{ tableRows.length }} ligne(s)</span>
        </div>
        <div class="flex flex-wrap gap-2">
          <!-- Bouton Importer (mode normal) -->
          <button *ngIf="!showImportSection" type="button"
                  (click)="showImport()"
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition-colors">
            <span class="material-icons text-base">cloud_upload</span>
            Importer
          </button>
          
          <!-- Bouton Retour (mode import) -->
          <button *ngIf="showImportSection" type="button"
                  (click)="hideImport()"
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-600 text-white text-sm font-medium hover:bg-gray-700 transition-colors">
            <span class="material-icons text-base">arrow_back</span>
            Retour
          </button>
          
          <!-- Boutons de téléchargement des modèles (visible en mode import uniquement) -->
          <button *ngIf="showImportSection" type="button"
                  (click)="downloadCSVTemplate()"
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-300 bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors">
            <span class="material-icons text-base">download</span>
            Modèle CSV
          </button>
          <button *ngIf="showImportSection" type="button"
                  (click)="downloadExcelTemplate()"
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-300 bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors">
            <span class="material-icons text-base">download</span>
            Modèle Excel
          </button>
          
          <!-- Bouton d'importation du fichier (mode import) -->
          <label *ngIf="showImportSection" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium cursor-pointer hover:bg-blue-700 transition-colors">
            <span class="material-icons text-base">upload_file</span>
            Importer fichier
            <input type="file" accept=".xlsx,.xls,.csv" class="hidden" (change)="onFileSelected($event)" />
          </label>
          
          <!-- Bouton Réinitialiser (si des données sont chargées) -->
          <button *ngIf="tableRows.length && showImportSection" type="button"
                  (click)="clearTable()"
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-300 bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors">
            <span class="material-icons text-base">refresh</span>
            Réinitialiser
          </button>
          
          <!-- Bouton Importer la liste (si des données sont valides) -->
          <button *ngIf="tableRows.length && showImportSection" type="button"
                  (click)="importList()"
                  [disabled]="isImporting || hasInvalidCells()"
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  [class.bg-blue-600]="!hasInvalidCells()"
                  [class.hover:bg-blue-700]="!hasInvalidCells()"
                  [class.bg-slate-400]="hasInvalidCells()">
            <span class="material-icons text-base" *ngIf="!isImporting">cloud_upload</span>
            <span class="material-icons text-base animate-spin" *ngIf="isImporting">refresh</span>
            {{ isImporting ? 'Import...' : (hasInvalidCells() ? 'Erreurs' : 'Importer la liste') }}
          </button>
        </div>
      </div>

      <!-- Status Bar (pour le mode import) -->
      <div *ngIf="tableRows.length && showImportSection" class="mt-3 flex items-center gap-6 text-sm">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full" [class.bg-green-500]="!hasInvalidCells()" [class.bg-red-500]="hasInvalidCells()"></div>
          <span [class.text-green-600]="!hasInvalidCells()" [class.text-red-600]="hasInvalidCells()">
            {{ hasInvalidCells() ? getInvalidCellsCount() + ' erreur(s)' : 'Données valides' }}
          </span>
        </div>
        <div class="flex items-center gap-4 text-xs text-slate-500">
          <span>{{ getValidCellsCount() }} valides</span>
          <span>{{ getTotalCellsCount() }} total</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== MESSAGES ===== -->
  <div *ngIf="errorMessage || successMessage || isProcessing" class="flex-shrink-0 px-6 py-2 bg-white border-b border-slate-200">
    <div *ngIf="errorMessage" class="flex items-center gap-2 text-sm text-red-700 bg-red-50 px-3 py-2 rounded">
      <span class="material-icons text-base">error_outline</span>
      <span>{{ errorMessage }}</span>
    </div>
    <div *ngIf="successMessage" class="flex items-center gap-2 text-sm text-green-700 bg-green-50 px-3 py-2 rounded">
      <span class="material-icons text-base">check_circle_outline</span>
      <span>{{ successMessage }}</span>
    </div>
    <div *ngIf="isProcessing" class="flex items-center gap-2 text-sm text-blue-700 bg-blue-50 px-3 py-2 rounded">
      <span class="material-icons text-base animate-spin">refresh</span>
      <span>Traitement en cours...</span>
    </div>
  </div>

  <!-- ===== CONFIGURATION SECTION (toujours visible) ===== -->
  <div class="flex-shrink-0 bg-white border-b border-slate-200 px-6 py-4">
    <h2 class="text-lg font-semibold text-slate-900 mb-4">Configuration</h2>
    
    <form [formGroup]="importForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
      <!-- Ville -->
      <div>
        <label for="ville_id" class="block text-sm font-medium text-slate-700 mb-2">
          Ville <span class="text-red-500">*</span>
        </label>
        <select
          id="ville_id"
          formControlName="ville_id"
          class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="">Sélectionner une ville</option>
          <option *ngFor="let ville of filterOptions.villes" [value]="ville.id">
            {{ ville.name }}
          </option>
        </select>
      </div>

      <!-- Établissement -->
      <div>
        <label for="etablissement_id" class="block text-sm font-medium text-slate-700 mb-2">
          Établissement <span class="text-red-500">*</span>
        </label>
        <select
          id="etablissement_id"
          formControlName="etablissement_id"
          class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="">Sélectionner un établissement</option>
          <option *ngFor="let etablissement of filterOptions.etablissements" [value]="etablissement.id">
            {{ etablissement.name }}
          </option>
        </select>
      </div>

      <!-- Date -->
      <div>
        <label for="date" class="block text-sm font-medium text-slate-700 mb-2">
          Date <span class="text-red-500">*</span>
        </label>
        <input
          type="date"
          id="date"
          formControlName="date"
          class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Heure début -->
      <div>
        <label for="heure_debut" class="block text-sm font-medium text-slate-700 mb-2">
          Heure début <span class="text-red-500">*</span>
        </label>
        <input
          type="time"
          id="heure_debut"
          formControlName="heure_debut"
          class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Heure fin -->
      <div>
        <label for="heure_fin" class="block text-sm font-medium text-slate-700 mb-2">
          Heure fin <span class="text-red-500">*</span>
        </label>
        <input
          type="time"
          id="heure_fin"
          formControlName="heure_fin"
          class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Devices (visible uniquement si une ville est sélectionnée) -->
      <div *ngIf="devices.length > 0" class="lg:col-span-5">
        <label class="block text-sm font-medium text-slate-700 mb-2">
          Devices (optionnel)
        </label>
        
        <!-- Champ de recherche pour les devices -->
        <div class="mb-3 relative">
          <span class="material-icons absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" style="font-size: 18px;">search</span>
          <input
            type="text"
            [(ngModel)]="deviceSearchTerm"
            [ngModelOptions]="{standalone: true}"
            placeholder="Rechercher un device par nom ou ID..."
            class="w-full pl-10 pr-10 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
          />
          <button
            *ngIf="deviceSearchTerm"
            (click)="clearDeviceSearch()"
            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors"
            type="button"
          >
            <span class="material-icons" style="font-size: 18px;">close</span>
          </button>
        </div>

        <div class="border border-slate-300 rounded-md p-4 max-h-[200px] overflow-y-auto bg-slate-50">
          <div *ngIf="getFilteredDevices().length > 0" class="space-y-2">
            <label *ngFor="let device of getFilteredDevices()" class="flex items-center gap-2 cursor-pointer hover:bg-slate-100 p-2 rounded transition-colors">
              <input
                type="checkbox"
                [value]="device.devid"
                [checked]="isDeviceSelected(device.devid)"
                (change)="toggleDevice(device.devid, $event)"
                class="w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <span class="text-sm text-slate-700 flex-1">
                {{ device.devnm }} <span class="text-slate-500 text-xs">(ID: {{ device.devid }})</span>
              </span>
            </label>
          </div>
          <div *ngIf="getFilteredDevices().length === 0" class="text-center py-4 text-sm text-slate-500">
            <span class="material-icons text-slate-400 mb-2" style="font-size: 24px; display: block;">search_off</span>
            Aucun device trouvé pour "{{ deviceSearchTerm }}"
          </div>
        </div>
        <div class="mt-2 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <p class="text-xs text-slate-500">
              Sélectionnez les devices autorisés. Laissez vide pour tous les devices.
            </p>
            <span *ngIf="deviceSearchTerm" class="text-xs text-slate-600 font-medium">
              ({{ getFilteredDevices().length }} sur {{ devices.length }})
            </span>
          </div>
          <button
            *ngIf="getSelectedDevicesCount() > 0"
            type="button"
            (click)="clearAllDevices()"
            class="text-xs text-blue-600 hover:text-blue-800 font-medium"
          >
            Tout désélectionner
          </button>
        </div>
      </div>
      <div *ngIf="loadingDevices" class="lg:col-span-5">
        <div class="flex items-center gap-2 text-sm text-slate-600">
          <span class="material-icons animate-spin" style="font-size: 16px;">refresh</span>
          <span>Chargement des devices...</span>
        </div>
      </div>
    </form>

    <!-- Bouton Lancer (pour afficher les données existantes) -->
    <div *ngIf="!showImportSection" class="mt-4">
      <button
        type="button"
        (click)="loadAttendanceData()"
        [disabled]="loading || importForm.invalid"
        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <span class="material-icons text-base" *ngIf="!loading">play_arrow</span>
        <span class="material-icons text-base animate-spin" *ngIf="loading">refresh</span>
        {{ loading ? 'Chargement...' : 'Lancer' }}
      </button>
    </div>
  </div>

  <!-- ===== EMPTY STATE (mode import sans données) ===== -->
  <div *ngIf="showImportSection && !tableRows.length && !isProcessing" class="flex-1 flex items-center justify-center">
    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100 mb-4">
        <svg class="h-8 w-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
        </svg>
      </div>
      <h3 class="text-lg font-medium text-slate-900 mb-2">Aucune donnée importée</h3>
      <p class="text-sm text-slate-500">Sélectionnez un fichier Excel ou CSV pour commencer</p>
    </div>
  </div>

  <!-- ===== DATA TABLE (mode import avec données) ===== -->
  <div *ngIf="showImportSection && tableRows.length" class="flex-1 overflow-hidden">
    <div class="h-full overflow-auto">
      <table class="w-full border-collapse">
        <thead class="sticky top-0 z-20 bg-slate-100 border-b-2 border-slate-300">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase border-r border-slate-300" style="width: 60px;">#</th>
            <th *ngFor="let header of tableHeaders" 
                class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase border-r border-slate-300"
                [style.width]="getColumnWidth(header)">
              <div class="flex items-center gap-2">
                <span>{{ getHeaderDisplayName(header) }}</span>
                <span *ngIf="relationHeaders.includes(header)" class="text-red-500">*</span>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <!-- Each row with dedicated space for suggestions -->
          <ng-container *ngFor="let row of tableRows; trackBy: trackByRow; let i = index">
            <!-- Data Row -->
            <tr class="bg-white border-b border-slate-200 hover:bg-slate-50"
                [class.bg-red-50]="isRowInvalid(i)"
                [class.border-l-4]="isRowInvalid(i)"
                [class.border-red-500]="isRowInvalid(i)"
                [style.position]="hasActiveDropdown(i) ? 'relative' : 'static'"
                [style.z-index]="hasActiveDropdown(i) ? '100' : 'auto'">
              <!-- Row Number -->
              <td class="px-4 py-4 text-center font-semibold text-slate-600 border-r border-slate-200 bg-slate-50">
                {{ i + 1 }}
              </td>
              
              <!-- Data Cells -->
              <td *ngFor="let header of tableHeaders" 
                  class="px-4 py-4 border-r border-slate-200 align-top relative"
                  [class.bg-red-50]="isCellInvalid(i, header)">
                <div class="space-y-2">
                  <!-- Input Field -->
                  <input type="text"
                         [value]="row[header]"
                         (input)="updateCell(i, header, $any($event.target).value)"
                         (focus)="onInputFocus(i, header)"
                         (blur)="onInputBlur(i, header)"
                         (keydown)="onKeyDown($event, i, header)"
                         [placeholder]="getPlaceholder(header)"
                         class="w-full px-3 py-2 text-sm border-2 rounded-lg focus:outline-none focus:ring-2 transition-all"
                         [class.border-red-400]="isCellInvalid(i, header)"
                         [class.bg-red-50]="isCellInvalid(i, header)"
                         [class.focus:ring-red-500]="isCellInvalid(i, header)"
                         [class.focus:border-red-500]="isCellInvalid(i, header)"
                         [class.border-green-400]="!isCellInvalid(i, header) && relationHeaders.includes(header) && row[header]"
                         [class.bg-green-50]="!isCellInvalid(i, header) && relationHeaders.includes(header) && row[header]"
                         [class.focus:ring-green-500]="!isCellInvalid(i, header) && relationHeaders.includes(header)"
                         [class.border-slate-300]="!isCellInvalid(i, header) && !relationHeaders.includes(header)"
                         [class.focus:ring-blue-500]="!isCellInvalid(i, header) && !relationHeaders.includes(header)" />
                  
                  <!-- Dropdown Suggestions -->
                  <div *ngIf="isDropdownVisible(i, header)" 
                       class="absolute z-50 mt-1 w-[calc(100%-2rem)] bg-white border-2 border-blue-400 rounded-lg shadow-xl max-h-60 overflow-y-auto dropdown-enter">
                    <button *ngFor="let suggestion of dropdownSuggestions; let idx = index"
                            (mousedown)="selectSuggestion(suggestion, i, header)"
                            [class.bg-blue-100]="idx === selectedSuggestionIndex"
                            [class.border-l-4]="idx === selectedSuggestionIndex"
                            [class.border-blue-600]="idx === selectedSuggestionIndex"
                            class="w-full text-left px-3 py-2 hover:bg-blue-50 border-b border-slate-200 text-sm transition-colors">
                      <div class="flex items-center gap-2">
                        <span class="material-icons text-blue-600" style="font-size: 16px;">check_circle</span>
                        <span class="flex-1">{{ suggestion.label }}</span>
                        <span *ngIf="idx === 0" class="text-xs font-bold text-blue-700 bg-blue-200 px-2 py-0.5 rounded">TOP</span>
                      </div>
                    </button>
                    <div *ngIf="dropdownSuggestions.length === 0" class="px-3 py-2 text-sm text-slate-500 italic">
                      Aucune suggestion disponible
                    </div>
                  </div>
                  
                  <!-- Status Indicator -->
                  <div class="flex items-center gap-1 text-xs">
                    <span *ngIf="isCellInvalid(i, header)" class="flex items-center gap-1 text-red-600">
                      <span class="material-icons" style="font-size: 14px;">error</span>
                      <span>Invalide</span>
                    </span>
                    <span *ngIf="!isCellInvalid(i, header) && relationHeaders.includes(header) && row[header]" class="flex items-center gap-1 text-green-600">
                      <span class="material-icons" style="font-size: 14px;">check_circle</span>
                      <span>Valide</span>
                    </span>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===== CONSULTATION MODE: MESSAGE AUCUN ÉTUDIANT TROUVÉ ===== -->
  <div *ngIf="!showImportSection && !loading && students.length === 0 && hasTriedToLoad" class="flex-1 flex items-center justify-center">
    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-amber-100 mb-4">
        <span class="material-icons text-amber-600 text-3xl">warning</span>
      </div>
      <h3 class="text-lg font-medium text-slate-900 mb-2">Aucun étudiant trouvé</h3>
      <p class="text-sm text-slate-500">Vérifiez les paramètres de configuration et réessayez</p>
    </div>
  </div>

  <!-- ===== CONSULTATION MODE: LISTE DES ÉTUDIANTS ===== -->
  <div *ngIf="!showImportSection && students.length > 0" class="flex-1 overflow-hidden px-6 py-4">
    <div class="h-full bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden flex flex-col">
      <!-- Statistiques -->
      <div class="flex-shrink-0 px-6 py-4 border-b border-slate-200 bg-slate-50">
        <div class="flex items-center gap-6">
          <div class="flex items-center gap-2">
            <span class="text-sm font-medium text-slate-600">Total:</span>
            <span class="text-lg font-bold text-slate-900">{{ totalStudents }}</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm font-medium text-green-600">Présents:</span>
            <span class="text-lg font-bold text-green-700">{{ presentCount }}</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm font-medium text-red-600">Absents:</span>
            <span class="text-lg font-bold text-red-700">{{ absentCount }}</span>
          </div>
        </div>
      </div>

      <!-- Section de recherche -->
      <div class="flex-shrink-0 px-6 py-4 border-b border-slate-200 bg-white">
        <div class="flex items-center gap-4">
          <div class="flex-1 relative">
            <span class="material-icons absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" style="font-size: 20px;">search</span>
            <input 
              type="text" 
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              placeholder="Rechercher par matricule, nom ou prénom..."
              class="w-full pl-10 pr-10 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm">
            <button 
              *ngIf="searchTerm"
              (click)="clearSearch()"
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
              <span class="material-icons" style="font-size: 20px;">close</span>
            </button>
          </div>
          <div *ngIf="searchTerm" class="text-sm text-slate-600">
            <span class="font-medium">{{ filteredStudents.length }}</span> résultat(s) trouvé(s)
          </div>
        </div>
      </div>

      <!-- Liste des étudiants -->
      <div class="flex-1 overflow-auto">
        <table class="w-full">
          <thead class="sticky top-0 bg-slate-100 border-b border-slate-200">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">#</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Matricule</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Nom</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Prénom</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Promotion</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Groupe</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Option</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Statut</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Heure de pointage</th>
              <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase">Device</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of filteredStudents; let i = index" 
                class="border-b border-slate-100 hover:bg-slate-50 transition-colors"
                [class.bg-green-50]="isStudentPresent(student)"
                [class.bg-red-50]="!isStudentPresent(student)">
              <td class="px-4 py-3 text-sm text-slate-600 font-semibold">{{ i + 1 }}</td>
              <td class="px-4 py-3 text-sm text-slate-600">{{ student.cne || student.matricule || '-' }}</td>
              <td class="px-4 py-3 text-sm font-medium text-slate-900">{{ student.nom || student.last_name || '-' }}</td>
              <td class="px-4 py-3 text-sm text-slate-700">{{ student.prenom || student.first_name || '-' }}</td>
              <td class="px-4 py-3 text-sm text-slate-600">{{ student.promotion_name || '-' }}</td>
              <td class="px-4 py-3 text-sm text-slate-600">{{ student.group_title || '-' }}</td>
              <td class="px-4 py-3 text-sm text-slate-600">{{ student.option_name || '-' }}</td>
              <td class="px-4 py-3">
                <span *ngIf="isStudentPresent(student)" class="inline-flex items-center gap-1 px-3 py-1.5 bg-green-100 text-green-800 text-xs font-semibold rounded-full">
                  <span class="material-icons" style="font-size: 14px;">check_circle</span>
                  Présent
                </span>
                <span *ngIf="!isStudentPresent(student)" class="inline-flex items-center gap-1 px-3 py-1.5 bg-red-100 text-red-800 text-xs font-semibold rounded-full">
                  <span class="material-icons" style="font-size: 14px;">cancel</span>
                  Absent
                </span>
              </td>
              <td class="px-4 py-3 text-sm text-slate-600">
                <span *ngIf="getPunchTime(student); else noPunchTime" class="font-medium">
                  {{ formatPunchTime(getPunchTime(student), student) }}
                </span>
                <ng-template #noPunchTime>
                  <span class="text-slate-400 italic">-</span>
                </ng-template>
              </td>
              <td class="px-4 py-3 text-sm text-slate-600">
                <span *ngIf="getDeviceName(student); else noDevice" class="font-medium">
                  {{ getDeviceName(student) }}
                </span>
                <ng-template #noDevice>
                  <span class="text-slate-400 italic">-</span>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
